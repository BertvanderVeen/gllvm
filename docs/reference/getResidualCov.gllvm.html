<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Extract residual covariance matrix from gllvm object — getResidualCov.gllvm • gllvm</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Extract residual covariance matrix from gllvm object — getResidualCov.gllvm" />
<meta property="og:description" content="Calculates the residual covariance matrix for gllvm model." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gllvm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/vignette1.html">Analysing multivariate abundance data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette2.html">Analysing high-dimensional microbial community data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette3.html">Introduction to gllvm Part 1: Ordination</a>
    </li>
    <li>
      <a href="../articles/vignette4.html">Introduction to gllvm Part 2: Species correlations</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/JenniNiku/gllvm/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract residual covariance matrix from gllvm object</h1>
    <small class="dont-index">Source: <a href='https://github.com/JenniNiku/gllvm/blob/master/R/getResidualCov.gllvm.R'><code>R/getResidualCov.gllvm.R</code></a></small>
    <div class="hidden name"><code>getResidualCov.gllvm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculates the residual covariance matrix for gllvm model.</p>
    </div>

    <pre class="usage"><span class='co'># S3 method for gllvm</span>
<span class='fu'>getResidualCov</span><span class='op'>(</span><span class='va'>object</span>, adjust <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>an object of class 'gllvm'.</p></td>
    </tr>
    <tr>
      <th>adjust</th>
      <td><p>The type of adjustment used for  negative binomial, binomial and normal distribution when computing residual correlation matrix. Options are 0 (no adjustment), 1 (the default adjustment) and 2 (alternative adjustment for NB distribution), see details.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Function returns following components:</p>
<dt>cov </dt><dd><p>residual covariance matrix</p></dd>
 <dt>trace </dt><dd><p>trace of the residual covariance matrix</p></dd>
 <dt>trace.q </dt><dd><p>trace of the residual covariance matrix per latent variable</p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Residual covariance matrix, storing information on species co-occurrence that is not explained by the environmental variables (if included), is calculated using the matrix of latent variables loadings, that is, \(\Theta\Theta'\).</p>
<p>When the responses are modelled using the negative binomial distribution, the residual variances for each species must be adjusted for overdispersion. The two possible adjustement terms are \(log(\phi_j + 1)\) (<code>adjust = 1</code>) and \(\psi^{(1)}(1/\phi_j)\) (<code>adjust = 2</code>), where \(\psi^{(1)}\) is the trigamma function.</p>
<p>The negative binomial model can be written using different parametrizations. 
The residual covariance with <code>adjust = 1</code> can be obtained using the lognormal-Poisson parametrization, that is,
$$Y_{ij} \sim Poisson(\mu_{ij} \lambda_j),$$
where \(\lambda_j \sim lognormal(-\sigma^2/2, \sigma^2)\) and \(\sigma^2 = log(\phi_j + 1)\) and \(log(\mu_{ij}) = \eta_{ij}\). Now \(E[Y_{ij}] = \mu_{ij}\) and variance \(V(\mu_{ij}) = \mu_{ij} + \mu_{ij}^2 (exp(\sigma^2) - 1) = \mu_{ij} + \mu_{ij}^2 \phi_j\), which are the same as for the NB distribution.
Therefore, on linear predictor scale, we have the variance 
$$V(log(\mu_{ij} \lambda_j)) = V(log\mu_{ij}) + V(log\lambda_j) = V(u_i'\theta_j) + \sigma^2 = \theta_j'\theta_j + log(\phi_j + 1).$$
which leads to the residual covariance matrix \(\Theta \Theta' + \eqn{\Psi}\), where \(\Psi\) is the diagonal matrix with \(log(\phi_j + 1)\) as diagonal elements (<code>adjust = 1</code>).</p>
<p>Or, for a GLLVM where species are a quadratic function of the latent variables, we instead have
$$V(log(\mu_{ij} \lambda_j)) = V(log\mu_{ij}) + V(log\lambda_j) = V(u_i'\theta_j-u_i' D_j u_i) + \sigma^2 = \theta_j'\theta_j + 2diag(D_j)'diag(D_j)log(\phi_j + 1).$$
which leads to the residual covariance matrix \(\Theta \Theta' + 2 \Gamma_j \Gamma_j' + diag(\Phi)\), where \(\Gamma_j\) holds the quadratic coefficients.
Since the quadratic coefficients are constrained to be positive, the residual covariance in the latter case is, given the same coefficients on the linear term, equal or more positive than in the linear case.</p>
<p>The residual covariance matrix with <code>adjust = 2</code> can be obtained by using Poisson-Gamma parametrization
$$Y_{ij} \sim Poisson(\mu_{ij} \lambda_j),$$
where \(\lambda_j \sim Gamma(1/\phi_j, 1/\phi_j)\) and \(\mu_{ij}\) is as above. The mean and the variance are of similar form as above and we have that
$$V(log(\mu_{ij} \lambda_j)) = V(log\mu_{ij}) + V(log\lambda_j) = \theta_j'\theta_j + \psi^{(1)}(1/\phi_j),$$
where \(\psi^{(1)}\) is the trigamma function.</p>
<p>In the case of binomial distribution, the adjustment terms (<code>adjust = 1</code>) are 1 for probit link and \(\pi^2/3\) for logit link.
These are obtained by treating binomial model as latent variable model. Assume
$$Y^*_{ij} = \eta_{ij} + e_{ij},$$
where \(e_{ij} \sim N(0, 1)\) for probit model, and \(e_{ij} ~ logistic(0, 1)\) for logit model.
Then binary response is defined as \(Y_{ij} = 1\), if \(Y^*_{ij} &gt; 0\) and 0 otherwise.
Now we have that \(\mu_{ij} = P(Y_{ij} = 1) = P(Y^*_{ij} &gt; 0) = P(\eta_{ij} &gt; -e_{ij}) = P(e_{ij} &lt;= \eta_{ij})\) which leads to probit and logit models.
On linear predictor scale we then have that
$$V(\eta_{ij} + e_{ij}) = V(\eta_{ij}) + V(e_{ij}).$$
For the probit model, the residual covariance matrix is then \(\Theta\Theta' + I_m\), and for the logit model \(\Theta\Theta' + \pi^2/3 I_m\).
Similarly as above, for a GLLVM where species are a quadratic function of the latent variables, the term \(2\Gamma_j\Gamma_j'\) is added to the residual covariance matrix.</p>
<p>For normal distribution, we can write
$$Y_{ij} = \eta_{ij} + e_{ij},$$
where \(e_{ij} \sim N(0, \phi_j^2)\) and thus we have that
$$V(\eta_{ij} + e_{ij}) = V(\eta_{ij}) + V(e_{ij}).$$
For the gaussian model, the residual covariance matrix is then \(\Theta\Theta' + diag(\Phi^2)\).</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Francis K.C. Hui, Jenni Niku, David I. Warton, Bert van der Veen</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># Load a dataset from the mvabund package</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>antTraits</span><span class='op'>)</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>antTraits</span><span class='op'>$</span><span class='va'>abund</span><span class='op'>)</span>
<span class='co'># Fit gllvm model</span>
<span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='gllvm.html'>gllvm</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='va'>y</span>, family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>poisson</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'># residual covariance:</span>
<span class='va'>rescov</span> <span class='op'>&lt;-</span> <span class='fu'>getResidualCov</span><span class='op'>(</span><span class='va'>fit</span><span class='op'>)</span>
<span class='va'>rescov</span><span class='op'>$</span><span class='va'>cov</span>
<span class='co'># Trace of the covariance matrix</span>
<span class='va'>rescov</span><span class='op'>$</span><span class='va'>trace</span>
<span class='co'># Trace per latent variable</span>
<span class='va'>rescov</span><span class='op'>$</span><span class='va'>trace.q</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jenni Niku, Wesley Brooks, Riki Herliansyah, Francis K.C. Hui, Sara Taskinen, David I. Warton, Bert van der Veen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


