<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Generalized Linear Latent Variable Models — gllvm • gllvm</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Generalized Linear Latent Variable Models — gllvm" />

<meta property="og:description" content="Fits generalized linear latent variable model for multivariate data. The model can be fitted using Laplace approximation method or variational
approximation method." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gllvm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/vignette1.html">Analysing multivariate abundance data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette2.html">Analysing high-dimensional microbial community data using gllvm</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/JenniNiku/gllvm.git">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generalized Linear Latent Variable Models</h1>
    <small class="dont-index">Source: <a href='https://github.com/JenniNiku/gllvm.git/blob/master/R/gllvm.R'><code>R/gllvm.R</code></a></small>
    <div class="hidden name"><code>gllvm.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Fits generalized linear latent variable model for multivariate data. The model can be fitted using Laplace approximation method or variational
approximation method.</p>
    
    </div>

    <pre class="usage"><span class='fu'>gllvm</span>(<span class='kw'>y</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>X</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>TR</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>formula</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>num.lv</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='no'>family</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"VA"</span>, <span class='kw'>row.eff</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>sd.errors</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>Lambda.struc</span> <span class='kw'>=</span> <span class='st'>"unstructured"</span>,
  <span class='kw'>diag.iter</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>trace</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>plot</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>la.link.bin</span> <span class='kw'>=</span> <span class='st'>"probit"</span>, <span class='kw'>n.init</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>Power</span> <span class='kw'>=</span> <span class='fl'>1.5</span>, <span class='kw'>reltol</span> <span class='kw'>=</span> <span class='fl'>1e-08</span>,
  <span class='kw'>seed</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>max.iter</span> <span class='kw'>=</span> <span class='fl'>200</span>, <span class='kw'>maxit</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>start.fit</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>starting.val</span> <span class='kw'>=</span> <span class='st'>"res"</span>, <span class='kw'>TMB</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>optimizer</span> <span class='kw'>=</span> <span class='st'>"optim"</span>,
  <span class='kw'>Lambda.start</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.1</span>, <span class='fl'>0.5</span>), <span class='kw'>jitter.var</span> <span class='kw'>=</span> <span class='fl'>0</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>y</th>
      <td><p>(n x m) matrix of responses.</p></td>
    </tr>
    <tr>
      <th>X</th>
      <td><p>matrix or data.frame of environmental covariates.</p></td>
    </tr>
    <tr>
      <th>TR</th>
      <td><p>matrix or data.frame of trait covariates.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>data in long format, that is, matrix of responses, environmental and trait covariates and row index named as ’id’. When used, model needs to be defined using formula. This is alternative data input for y, X and TR.</p></td>
    </tr>
    <tr>
      <th>formula</th>
      <td><p>an object of class "formula" (or one that can be coerced to that class): a symbolic description of the model to be fitted.</p></td>
    </tr>
    <tr>
      <th>num.lv</th>
      <td><p>number of latent variables, d, in gllvm model. Non-negative integer, less than number of response variables (m). Defaults to 2.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>distribution function for responses. Options are <code><a href='https://rdrr.io/r/stats/family.html'>poisson(link = "log")</a></code>, <code>"negative.binomial"</code> (with log link), <code><a href='https://rdrr.io/r/stats/family.html'>binomial(link = "probit")</a></code> (and also <code><a href='https://rdrr.io/r/stats/family.html'>binomial(link = "logit")</a></code> when <code>method = "LA"</code>), zero inflated poisson (<code>"ZIP"</code>), <code><a href='https://rdrr.io/r/stats/family.html'>gaussian(link = "identity")</a></code>, Tweedie (<code>"tweedie"</code>) (with log link, only with <code>"LA"</code>-method) and <code>"ordinal"</code> (only with <code>"VA"</code>-method).</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>model can be fitted using Laplace approximation method (<code>method = "LA"</code>) or variational approximation method (<code>method = "VA"</code>). Defaults to <code>"VA"</code>.</p></td>
    </tr>
    <tr>
      <th>row.eff</th>
      <td><p><code>FALSE</code>, <code>TRUE</code> or <code>"random"</code>, Indicating whether row effects are included in the model as a fixed or as a random effects. Defaults to <code>FALSE</code> when row effects are not included.</p></td>
    </tr>
    <tr>
      <th>offset</th>
      <td><p>vector or matrix of offset terms.</p></td>
    </tr>
    <tr>
      <th>sd.errors</th>
      <td><p>logical. If <code>TRUE</code> (default) standard errors for parameter estimates are calculated.</p></td>
    </tr>
    <tr>
      <th>Lambda.struc</th>
      <td><p>covariance structure of VA distributions for latent variables when <code>method = "VA"</code>, "unstructured" or "diagonal".</p></td>
    </tr>
    <tr>
      <th>diag.iter</th>
      <td><p>non-negative integer which is used to speed up the updating of variational (covariance) parameters in VA method. Defaults to 5.</p></td>
    </tr>
    <tr>
      <th>trace</th>
      <td><p>logical, if <code>TRUE</code> in each iteration step information on current step will be printed. Defaults to <code>FALSE</code>. Only with <code>TMB = FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>plot</th>
      <td><p>logical, if <code>TRUE</code> ordination plots will be printed in each iteration step when <code>TMB = FALSE</code>. Defaults to <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>la.link.bin</th>
      <td><p>link function for binomial family if <code>method = "LA"</code>. Options are "logit" and "probit.</p></td>
    </tr>
    <tr>
      <th>n.init</th>
      <td><p>number of initial runs. Uses multiple runs and picks up the one giving highest log-likelihood value. Defaults to 1.</p></td>
    </tr>
    <tr>
      <th>Power</th>
      <td><p>fixed power parameter in Tweedie model. Scalar from interval (1,2). Defaults to 1.5.</p></td>
    </tr>
    <tr>
      <th>reltol</th>
      <td><p>convergence criteria for log-likelihood, defaults to 1e-6.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>a single seed value, defaults to <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>max.iter</th>
      <td><p>maximum number of iterations when <code>TMB = FALSE</code>, defaults to 200.</p></td>
    </tr>
    <tr>
      <th>maxit</th>
      <td><p>maximum number of iterations within <code>optim</code> function, defaults to 1000.</p></td>
    </tr>
    <tr>
      <th>start.fit</th>
      <td><p>object of class 'gllvm' which can be given as starting parameters for count data (poisson, NB, or ZIP).</p></td>
    </tr>
    <tr>
      <th>starting.val</th>
      <td><p>starting values can be generated by fitting model without latent variables, and applying factorial analysis to residuals to get starting values for latent variables and their coefficients (<code>starting.val = "res"</code>). Another options are to use zeros as a starting values (<code>starting.val = "zero"</code>) or initialize starting values for latent variables with (n x num.lv) matrix. Defaults to <code>"res"</code>, which is recommended.</p></td>
    </tr>
    <tr>
      <th>TMB</th>
      <td><p>logical, if <code>TRUE</code> model will be fitted using Template Model Builder (TMB). TMB is always used if <code>method = "LA"</code>.  Defaults to <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>optimizer</th>
      <td><p>if <code>TMB=TRUE</code>, log-likelihood can be optimized using <code>"<a href='https://rdrr.io/r/stats/optim.html'>optim</a>"</code> (default) or <code>"<a href='https://rdrr.io/r/stats/nlminb.html'>nlminb</a>"</code>.</p></td>
    </tr>
    <tr>
      <th>Lambda.start</th>
      <td><p>starting values for variances in VA distributions for latent variables in variational approximation method. Defaults to 0.1.</p></td>
    </tr>
    <tr>
      <th>jitter.var</th>
      <td><p>jitter variance for starting values of latent variables. Defaults to 0, meaning no jittering.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class "gllvm" includes the following components:</p>

<p></p>
<dt>call </dt><dd><p>function call</p></dd>
 <dt>logL </dt><dd><p>log likelihood</p></dd>
 <dt>lvs </dt><dd><p>latent variables</p></dd>
 <dt>params</dt><dd><p>list of parameters
 <ul>
<li><p>theta  coefficients related to latent variables</p></li>
<li><p>beta0  column specific intercepts</p></li>
<li><p>Xcoef  coefficients related to environmental covariates X</p></li>
<li><p>B  coefficients in fourth corner model</p></li>
<li><p>row.params  row-specific intercepts</p></li>
<li><p>phi  dispersion parameters \(\phi\) for negative binomial or Tweedie family, probability of zero inflation for ZIP family or standard deviation for gaussian family</p></li>
<li><p>inv.phi  dispersion parameters \(1/\phi\) for negative binomial</p></li>
</ul></p></dd>
 <dt>Power </dt><dd><p>power parameter \(\nu\) for Tweedie family</p></dd>
 <dt>sd </dt><dd><p>list of standard errors of parameters</p></dd>
 <dt>prediction.errors </dt><dd><p>list of prediction covariances for latent variables and variances for random row effects when method <code>"LA"</code> is used</p></dd>
 <dt>A, Ar </dt><dd><p>covariance matrices for variational densities of latent variables and variances for random row effects</p></dd>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Fits generalized linear latent variable models as in Hui et al. (2015 and 2017) and Niku et al. (2017).
Method can be used with two types of latent variable models depending on covariates. If only
site related environmental covariates are used, the expectation of response \(Y_{ij}\) is determined by</p>
<p>$$g(\mu_{ij}) = \eta_{ij} = \alpha_i + \beta_{0j} + x_i'\beta_j + u_i'\theta_j,$$</p>
<p>where \(g(.)\) is a known link function, \(u_i\) are \(d\)-variate latent variables (\(d\)&lt;&lt;\(m\)), \(\alpha_i\) is an optional row effect
at site \(i\), and it can be fixed or random effect, \(\beta_{0j}\) is an intercept term for species \(j\), \(\beta_j\) and \(\theta_j\) are column
specific coefficients related to covariates and the latent variables, respectively.</p>
<p>An alternative model is the fourth corner model (Brown et al., 2014, Warton et al., 2015) which will be fitted if also trait covariates
are included. The expectation of response \(Y_{ij}\) is</p>
<p>$$g(\mu_{ij}) = \alpha_i + \beta_{0j} + x_i'\beta_x + TR_j'\beta_t + vec(B)*kronecker(TR_j,X_i) + u_i'\theta_j$$</p>
<p>where g(.), \(u_i\), \(\beta_{0j}\) and \(\theta_j\) are defined as above. Vectors \(\beta_x\) and \(\beta_t\) are the main effects
or coefficients related to environmental and trait covariates, respectively, matrix \(B\) includes interaction terms.
The interaction/fourth corner terms are optional as well as are the main effects of trait covariates.</p>

<p>The method is sensitive for the choices of initial values of the latent variables. Therefore it is
recommendable to use multiple runs and pick up the one giving the highest log-likelihood value.
However, sometimes this is computationally too demanding, and default option
<code>starting.val = "res"</code> is recommended. For more details on different starting value methods, see Niku et al., (2018).</p>
<p>Models are implemented using TMB (Kristensen et al., 2015) applied to variational approximation (Hui et al., 2017) and Laplace approximation (Niku et al., 2017).</p>
<p>An exception is ordinal family which is not implemented with TMB and therefore also <code>row.eff = "random"</code> does not work.
With ordinal family response classes must start from 0 or 1.</p>
<h3>Distributions</h3>


<p>Mean and variance for distributions are defined as follows.</p><ul>
<li><p>For count data <code>family = poisson()</code>: Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(\mu_{ij}) = \mu_{ij}\), or</p></li>
<li><p><code>family = "negative.binomial"</code>: Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(\mu_{ij}) = \mu_{ij}+\phi_j*\mu_{ij}^2\), or</p></li>
<li><p><code>family = "ZIP"</code>: Expectation \(E[Y_{ij}] = (1-p)\mu_{ij}\), variance \(V(\mu_{ij}) = \mu_{ij}(1-p)(1+\mu_{ij}p)\).</p></li>
<li><p>For binary data <code>family = binomial()</code>: Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(\mu_{ij}) = \mu_{ij}(1-\mu_{ij})\).</p></li>
<li><p>For biomass data <code>family = "tweedie"</code>: Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(\mu_{ij}) = \phi_j*\mu_{ij}^\nu\), where \(\nu\) is a power parameter of Tweedie distribution. See details Dunn and Smyth (2005).</p></li>
<li><p>For ordinal data <code>family = "ordinal"</code>: Cumulative probit model, see Hui et.al. (2016).</p></li>
<li><p>For normal distributed data <code>family = gaussian()</code>: Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(y_{ij}) = \phi_j^2.\)</p></li>
</ul>


    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>If function gives warning: 'In f(x, order = 0) : value out of range in 'lgamma'', optimizer have visited an area where gradients become too big. It is automatically fixed by trying another step in the optimization process, and can be ignored if errors do not occur.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Brown, A. M., Warton, D. I., Andrew, N. R., Binns, M., Cassis, G., and Gibb, H. (2014). The fourth-corner solution - using predictive models to understand how species traits interact with the environment. Methods in Ecology and Evolution, 5:344-352.</p>
<p>Dunn, P. K. and Smyth, G. K. (2005).  Series evaluation of tweedie exponential dispersion model densities. Statistics and Computing, 15:267-280.</p>
<p>Hui, F. K. C., Taskinen, S., Pledger, S., Foster, S. D., and Warton, D. I. (2015).  Model-based approaches to unconstrained ordination. Methods in Ecology and Evolution, 6:399-411.</p>
<p>Hui, F. K. C., Warton, D., Ormerod, J., Haapaniemi, V., and Taskinen, S. (2017).  Variational approximations for generalized linear latent variable models. Journal of Computational and Graphical Statistics. Journal of Computational and Graphical Statistics, 26:35-43.</p>
<p>Kasper Kristensen, Anders Nielsen, Casper W. Berg, Hans Skaug, Bradley M. Bell (2016). TMB: Automatic Differentiation and Laplace Approximation. Journal of Statistical Software, 70(5), 1-21.</p>
<p>Niku, J., Warton,  D. I., Hui, F. K. C., and Taskinen, S. (2017). Generalized linear latent variable models for multivariate count and biomass data in ecology. Journal of Agricultural, Biological, and Environmental Statistics, 22:498-522</p>
<p>Niku, J., Brooks, W., Herliansyah, R., Hui, F. K. C., Taskinen, S., and Warton,  D. I. (2018). Efficient estimation of generalized linear latent variable models. Submitted.</p>
<p>Warton, D. I., Guillaume Blanchet, F., O'Hara, R. B., Ovaskainen, O., Taskinen, S., Walker, S. C. and Hui, F. K. C. (2015). So many variables: Joint modeling in community ecology. Trends in Ecology &amp; Evolution, 30:766-779.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code>coefplot.gllvm</code>, <code>confint.gllvm</code>, <code>ordiplot.gllvm</code>, <code>plot.gllvm</code>, <code>residuals.gllvm</code>, <code>summary.gllvm</code>.</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Load a dataset from the mvabund package</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>antTraits</span>)
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span>(<span class='no'>antTraits</span>$<span class='no'>abund</span>)
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span>(<span class='no'>antTraits</span>$<span class='no'>env</span>)
<span class='no'>TR</span> <span class='kw'>&lt;-</span> <span class='no'>antTraits</span>$<span class='no'>traits</span>
<span class='co'># Fit model with environmental covariates Bare.ground and Shrub.cover</span>
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='no'>y</span>, <span class='no'>X</span>, <span class='kw'>formula</span> <span class='kw'>=</span> ~ <span class='no'>Bare.ground</span> + <span class='no'>Shrub.cover</span>,
            <span class='kw'>family</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>poisson</a></span>())
<span class='fu'>ordiplot</span>(<span class='no'>fit</span>)</div><div class='img'><img src='gllvm-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'>coefplot</span>(<span class='no'>fit</span>)</div><div class='img'><img src='gllvm-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># \donttest{</span>
<span class='co'>## Example 1: Fit model with two latent variables</span>
<span class='co'># Using variational approximation:</span>
<span class='no'>fitv0</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='no'>y</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"negative.binomial"</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"VA"</span>)
<span class='fu'>ordiplot</span>(<span class='no'>fitv0</span>)
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>fitv0</span>, <span class='kw'>mfrow</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2</span>,<span class='fl'>2</span>))</div><div class='img'><img src='gllvm-3.png' alt='' width='700' height='433' /></div><div class='img'><img src='gllvm-4.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>fitv0</span>)</div><div class='output co'>#&gt; $`log-likelihood`
#&gt; [1] -1895.085
#&gt; 
#&gt; $df
#&gt; [1] 163
#&gt; 
#&gt; $AIC
#&gt; [1] 4116.171
#&gt; 
#&gt; $AICc
#&gt; [1] 3717.185
#&gt; 
#&gt; $BIC
#&gt; [1] 4344.566
#&gt; 
#&gt; $Call
#&gt; gllvm(y = y, family = "negative.binomial", method = "VA")
#&gt; 
#&gt; $family
#&gt; [1] "negative.binomial"
#&gt; 
#&gt; $Coefficients
#&gt;                                 Intercept  theta.LV1   theta.LV2
#&gt; Amblyopone.australis          -0.94450213  0.8768284  0.00000000
#&gt; Aphaenogaster.longiceps       -3.28438461  0.1001971  2.78130164
#&gt; Camponotus.cinereus.amperei   -2.26725032  0.8375267  0.51000512
#&gt; Camponotus.claripes            0.51221879  0.3790267  0.42638364
#&gt; Camponotus.consobrinus         1.21761837  0.7436534 -0.84715325
#&gt; Camponotus.nigriceps          -0.60002838 -0.5084259  0.78903500
#&gt; Camponotus.nigroaeneus        -0.54162428  0.4991768  0.38415864
#&gt; Cardiocondyla.nuda.atalanta   -2.67282022 -2.2296822 -0.92031721
#&gt; Crematogaster.sp..A           -2.31865151  1.8420177  1.52105242
#&gt; Heteroponera.sp..A             1.23907362  0.1775052 -0.56049453
#&gt; Iridomyrmex.bicknelli          1.28800144  0.1717371 -1.02189764
#&gt; Iridomyrmex.dromus            -0.79783664  0.8844309 -0.09388062
#&gt; Iridomyrmex.mjobergi           1.33241491 -0.4540200  0.05855657
#&gt; Iridomyrmex.purpureus         -0.08730823  1.2679525  0.91799637
#&gt; Iridomyrmex.rufoniger          2.36210828 -0.1625533 -0.79025096
#&gt; Iridomyrmex.suchieri           0.45342990  0.3676355 -0.75075807
#&gt; Iridomyrmex.suchieroides      -0.44410518 -0.4648376 -0.81644359
#&gt; Melophorus.sp..E              -1.19179870  0.1178175 -0.42635374
#&gt; Melophorus.sp..F               0.53223613 -0.5522213 -0.36058776
#&gt; Melophorus.sp..H              -0.55685091 -0.8236375 -0.44406708
#&gt; Meranoplus.sp..A              -0.40366851 -0.9266753 -1.00782420
#&gt; Monomorium.leae                1.34447661  0.6285240  0.36496063
#&gt; Monomorium.rothsteini          0.23827205 -0.9267759 -1.61299194
#&gt; Monomorium.sydneyense         -0.45685534 -0.7795364 -0.77730749
#&gt; Myrmecia.pilosula.complex     -1.12818473  0.1331890 -0.74925256
#&gt; Notoncus.capitatus            -0.96921023  1.3335389  0.40112752
#&gt; Notoncus.ectatommoides         0.73055038 -0.8009323 -0.20923164
#&gt; Nylanderia.sp..A               0.74955432 -0.7850937 -0.98686936
#&gt; Ochetellus.glaber             -2.04070380 -0.5851694 -1.99992826
#&gt; Paraparatrechina.sp..B        -1.51765790 -1.4159633  0.86111264
#&gt; Pheidole.sp..A                 2.31789865 -0.3760909 -0.19599972
#&gt; Pheidole.sp..B                -1.09154102 -0.2636695  0.78633093
#&gt; Pheidole.sp..E                 1.60315849  0.3899165 -0.20298354
#&gt; Pheidole.sp..J                -1.77242154 -0.2889068  0.55428933
#&gt; Polyrhachis.sp..A             -1.25634681  0.3247050 -0.07313660
#&gt; Rhytidoponera.metallica.sp..A  2.02290058 -0.3468395 -0.28259578
#&gt; Rhytidoponera.sp..B            0.34785215 -0.9979918 -0.62688924
#&gt; Solenopsis.sp..A              -2.20047136 -0.5276368  0.22408473
#&gt; Stigmacros.sp..A              -0.28927395  0.8261697  0.08306947
#&gt; Tapinoma.sp..A                 0.75958588  0.3600978 -0.43538387
#&gt; Tetramorium.sp..A              0.07318773 -0.8131548 -0.90049913
#&gt; 
#&gt; $`Dispersion parameters`
#&gt;          Amblyopone.australis       Aphaenogaster.longiceps 
#&gt;                     1.8555484                     2.5126849 
#&gt;   Camponotus.cinereus.amperei           Camponotus.claripes 
#&gt;                     1.3267631                     1.2684447 
#&gt;        Camponotus.consobrinus          Camponotus.nigriceps 
#&gt;                     0.5149768                     4.3760620 
#&gt;        Camponotus.nigroaeneus   Cardiocondyla.nuda.atalanta 
#&gt;                     2.0744951                     5.6699283 
#&gt;           Crematogaster.sp..A            Heteroponera.sp..A 
#&gt;                     4.4544426                     0.7424727 
#&gt;         Iridomyrmex.bicknelli            Iridomyrmex.dromus 
#&gt;                     0.4070754                     4.0048425 
#&gt;          Iridomyrmex.mjobergi         Iridomyrmex.purpureus 
#&gt;                     0.4284581                     4.6303535 
#&gt;         Iridomyrmex.rufoniger          Iridomyrmex.suchieri 
#&gt;                     0.1051020                     0.9078260 
#&gt;      Iridomyrmex.suchieroides              Melophorus.sp..E 
#&gt;                     0.5178927                     1.3444171 
#&gt;              Melophorus.sp..F              Melophorus.sp..H 
#&gt;                     0.4170904                     0.6392857 
#&gt;              Meranoplus.sp..A               Monomorium.leae 
#&gt;                     3.2303460                     1.0309306 
#&gt;         Monomorium.rothsteini         Monomorium.sydneyense 
#&gt;                     0.7242055                     1.6957540 
#&gt;     Myrmecia.pilosula.complex            Notoncus.capitatus 
#&gt;                     1.9731088                     5.8036532 
#&gt;        Notoncus.ectatommoides              Nylanderia.sp..A 
#&gt;                     0.5022866                     1.3169111 
#&gt;             Ochetellus.glaber        Paraparatrechina.sp..B 
#&gt;                     2.2925210                     8.4111256 
#&gt;                Pheidole.sp..A                Pheidole.sp..B 
#&gt;                     0.1044527                     2.0254379 
#&gt;                Pheidole.sp..E                Pheidole.sp..J 
#&gt;                     0.6639871                     3.8319329 
#&gt;             Polyrhachis.sp..A Rhytidoponera.metallica.sp..A 
#&gt;                     0.2709750                     0.1403761 
#&gt;           Rhytidoponera.sp..B              Solenopsis.sp..A 
#&gt;                     1.4744064                     0.8888399 
#&gt;              Stigmacros.sp..A                Tapinoma.sp..A 
#&gt;                     1.9578342                     0.8384678 
#&gt;             Tetramorium.sp..A 
#&gt;                     0.5999489 
#&gt; 
#&gt; attr(,"class")
#&gt; [1] "summary.gllvm"</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/stats/confint.html'>confint</a></span>(<span class='no'>fitv0</span>)</div><div class='output co'>#&gt;                                                2.5 %       97.5 %
#&gt; theta.LV1.1                             -0.101340821  1.854997633
#&gt; theta.LV1.2                             -2.931435901  3.131830122
#&gt; theta.LV1.3                             -0.636218612  2.311272033
#&gt; theta.LV1.4                             -0.487085077  1.245138404
#&gt; theta.LV1.5                             -0.198926413  1.686233308
#&gt; theta.LV1.6                             -2.261272368  1.244420640
#&gt; theta.LV1.7                             -0.662731327  1.661085001
#&gt; theta.LV1.8                             -4.479102341  0.019737972
#&gt; theta.LV1.9                             -0.582236289  4.266271774
#&gt; theta.LV1.10                            -0.479319831  0.834330187
#&gt; theta.LV1.11                            -0.875516557  1.218990830
#&gt; theta.LV1.12                            -0.385065233  2.153927075
#&gt; theta.LV1.13                            -0.788359618 -0.119680383
#&gt; theta.LV1.14                            -0.360864861  2.896769775
#&gt; theta.LV1.15                            -0.929018762  0.603912150
#&gt; theta.LV1.16                            -0.511753177  1.247024220
#&gt; theta.LV1.17                            -1.393251575  0.463576395
#&gt; theta.LV1.18                            -0.805653071  1.041288080
#&gt; theta.LV1.19                            -1.045193052 -0.059249543
#&gt; theta.LV1.20                            -1.536604074 -0.110670834
#&gt; theta.LV1.21                            -2.433929526  0.580578859
#&gt; theta.LV1.22                            -0.008269254  1.265317282
#&gt; theta.LV1.23                            -2.536485246  0.682933529
#&gt; theta.LV1.24                            -1.759874775  0.200801927
#&gt; theta.LV1.25                            -0.968495765  1.234873735
#&gt; theta.LV1.26                            -0.656288996  3.323366739
#&gt; theta.LV1.27                            -1.275115387 -0.326749136
#&gt; theta.LV1.28                            -1.877164358  0.306976997
#&gt; theta.LV1.29                            -2.749420726  1.579081961
#&gt; theta.LV1.30                            -3.828804595  0.996878009
#&gt; theta.LV1.31                            -0.651307507 -0.100874347
#&gt; theta.LV1.32                            -1.471722413  0.944383319
#&gt; theta.LV1.33                            -0.029457796  0.809290865
#&gt; theta.LV1.34                            -1.431487961  0.853674331
#&gt; theta.LV1.35                            -0.463945555  1.113355562
#&gt; theta.LV1.36                            -0.684930970 -0.008748027
#&gt; theta.LV1.37                            -1.955046885 -0.040936704
#&gt; theta.LV1.38                            -1.521901695  0.466628152
#&gt; theta.LV1.39                            -0.120120421  1.772459840
#&gt; theta.LV1.40                            -0.246798179  0.966993714
#&gt; theta.LV1.41                            -1.793791744  0.167482131
#&gt; theta.LV2.1                              0.000000000  0.000000000
#&gt; theta.LV2.2                              1.078501227  4.484102056
#&gt; theta.LV2.3                             -0.661158972  1.681169205
#&gt; theta.LV2.4                             -0.123809771  0.976577056
#&gt; theta.LV2.5                             -1.688742013 -0.005564484
#&gt; theta.LV2.6                             -0.221635840  1.799705847
#&gt; theta.LV2.7                             -0.400417935  1.168735209
#&gt; theta.LV2.8                             -3.926897127  2.086262708
#&gt; theta.LV2.9                             -0.798057147  3.840161994
#&gt; theta.LV2.10                            -1.012573109 -0.108415950
#&gt; theta.LV2.11                            -1.555129182 -0.488666106
#&gt; theta.LV2.12                            -1.392530681  1.204769441
#&gt; theta.LV2.13                            -0.448507453  0.565620586
#&gt; theta.LV2.14                            -0.556049609  2.392042348
#&gt; theta.LV2.15                            -1.136315032 -0.444186893
#&gt; theta.LV2.16                            -1.452266017 -0.049250115
#&gt; theta.LV2.17                            -1.674890459  0.042003273
#&gt; theta.LV2.18                            -1.325273138  0.472565660
#&gt; theta.LV2.19                            -0.998500692  0.277325170
#&gt; theta.LV2.20                            -1.413396319  0.525262159
#&gt; theta.LV2.21                            -2.527932491  0.512284086
#&gt; theta.LV2.22                            -0.300444610  1.030365873
#&gt; theta.LV2.23                            -2.889165826 -0.336818049
#&gt; theta.LV2.24                            -1.890493282  0.335878308
#&gt; theta.LV2.25                            -1.950076652  0.451571534
#&gt; theta.LV2.26                            -1.163575703  1.965830749
#&gt; theta.LV2.27                            -1.036116772  0.617653495
#&gt; theta.LV2.28                            -2.005545836  0.031807107
#&gt; theta.LV2.29                            -4.111095189  0.111238675
#&gt; theta.LV2.30                            -0.783942105  2.506167382
#&gt; theta.LV2.31                            -0.578952240  0.186952799
#&gt; theta.LV2.32                             0.064841762  1.507820098
#&gt; theta.LV2.33                            -0.690770041  0.284802961
#&gt; theta.LV2.34                            -0.783962664  1.892541331
#&gt; theta.LV2.35                            -0.730491376  0.584218178
#&gt; theta.LV2.36                            -0.653833688  0.088642135
#&gt; theta.LV2.37                            -1.700033690  0.446255209
#&gt; theta.LV2.38                            -0.831367124  1.279536589
#&gt; theta.LV2.39                            -0.828897422  0.995036354
#&gt; theta.LV2.40                            -0.963029806  0.092262061
#&gt; theta.LV2.41                            -1.891441074  0.090442822
#&gt; Intercept.Amblyopone.australis          -1.856811750 -0.032192520
#&gt; Intercept.Aphaenogaster.longiceps       -6.250405788 -0.318363436
#&gt; Intercept.Camponotus.cinereus.amperei   -3.698745146 -0.835755497
#&gt; Intercept.Camponotus.claripes           -0.036067687  1.060505272
#&gt; Intercept.Camponotus.consobrinus         0.642111889  1.793124851
#&gt; Intercept.Camponotus.nigriceps          -1.679526282  0.479469512
#&gt; Intercept.Camponotus.nigroaeneus        -1.317326168  0.234077605
#&gt; Intercept.Cardiocondyla.nuda.atalanta   -5.331502560 -0.014137887
#&gt; Intercept.Crematogaster.sp..A           -4.740385623  0.103082603
#&gt; Intercept.Heteroponera.sp..A             0.801957792  1.676189452
#&gt; Intercept.Iridomyrmex.bicknelli          0.772251576  1.803751306
#&gt; Intercept.Iridomyrmex.dromus            -1.858060241  0.262386956
#&gt; Intercept.Iridomyrmex.mjobergi           0.981622191  1.683207623
#&gt; Intercept.Iridomyrmex.purpureus         -1.287432108  1.112815651
#&gt; Intercept.Iridomyrmex.rufoniger          2.021757449  2.702459119
#&gt; Intercept.Iridomyrmex.suchieri          -0.135326321  1.042186125
#&gt; Intercept.Iridomyrmex.suchieroides      -1.135717244  0.247506883
#&gt; Intercept.Melophorus.sp..E              -2.008936464 -0.374660939
#&gt; Intercept.Melophorus.sp..F               0.082460767  0.982011489
#&gt; Intercept.Melophorus.sp..H              -1.273560806  0.159858992
#&gt; Intercept.Meranoplus.sp..A              -1.455211217  0.647874199
#&gt; Intercept.Monomorium.leae                0.841597055  1.847356165
#&gt; Intercept.Monomorium.rothsteini         -0.731889470  1.208433565
#&gt; Intercept.Monomorium.sydneyense         -1.320688289  0.406977613
#&gt; Intercept.Myrmecia.pilosula.complex     -2.054218097 -0.202151362
#&gt; Intercept.Notoncus.capitatus            -2.472752282  0.534331823
#&gt; Intercept.Notoncus.ectatommoides         0.238830468  1.222270296
#&gt; Intercept.Nylanderia.sp..A               0.029817846  1.469290790
#&gt; Intercept.Ochetellus.glaber             -3.864502571 -0.216905024
#&gt; Intercept.Paraparatrechina.sp..B        -3.310478827  0.275163032
#&gt; Intercept.Pheidole.sp..A                 2.092269819  2.543527472
#&gt; Intercept.Pheidole.sp..B                -2.030042494 -0.153039542
#&gt; Intercept.Pheidole.sp..E                 1.226661964  1.979655020
#&gt; Intercept.Pheidole.sp..J                -2.977867817 -0.566975259
#&gt; Intercept.Polyrhachis.sp..A             -1.984227554 -0.528466073
#&gt; Intercept.Rhytidoponera.metallica.sp..A  1.772572905  2.273228247
#&gt; Intercept.Rhytidoponera.sp..B           -0.397866519  1.093570820
#&gt; Intercept.Solenopsis.sp..A              -3.425452730 -0.975489989
#&gt; Intercept.Stigmacros.sp..A              -1.091479471  0.512931577
#&gt; Intercept.Tapinoma.sp..A                 0.282082322  1.237089441
#&gt; Intercept.Tetramorium.sp..A             -0.631906732  0.778282195
#&gt; inv.phi.Amblyopone.australis            -0.270128907  1.347977386
#&gt; inv.phi.Aphaenogaster.longiceps         -0.211165551  1.007126867
#&gt; inv.phi.Camponotus.cinereus.amperei     -1.084696760  2.592124841
#&gt; inv.phi.Camponotus.claripes              0.057461614  1.519272443
#&gt; inv.phi.Camponotus.consobrinus           0.053325220  3.830344803
#&gt; inv.phi.Camponotus.nigriceps            -0.061376902  0.518408815
#&gt; inv.phi.Camponotus.nigroaeneus          -0.106429796  1.070519790
#&gt; inv.phi.Cardiocondyla.nuda.atalanta     -0.070025705  0.422763854
#&gt; inv.phi.Crematogaster.sp..A             -0.079376952  0.528366915
#&gt; inv.phi.Heteroponera.sp..A               0.225126977  2.468574740
#&gt; inv.phi.Iridomyrmex.bicknelli           -0.117650593  5.030745375
#&gt; inv.phi.Iridomyrmex.dromus              -0.066789242  0.566184665
#&gt; inv.phi.Iridomyrmex.mjobergi            -0.169883119  4.837784104
#&gt; inv.phi.Iridomyrmex.purpureus            0.009105391  0.422827070
#&gt; inv.phi.Iridomyrmex.rufoniger           -0.083330987 19.112465613
#&gt; inv.phi.Iridomyrmex.suchieri            -0.154760645  2.357826032
#&gt; inv.phi.Iridomyrmex.suchieroides        -0.884386178  4.746189777
#&gt; inv.phi.Melophorus.sp..E                -0.831904508  2.319538057
#&gt; inv.phi.Melophorus.sp..F                -0.514357632  5.309480899
#&gt; inv.phi.Melophorus.sp..H                -0.423396667  3.551888268
#&gt; inv.phi.Meranoplus.sp..A                -0.018476428  0.637605155
#&gt; inv.phi.Monomorium.leae                  0.248502922  1.691491918
#&gt; inv.phi.Monomorium.rothsteini            0.014917355  2.746729586
#&gt; inv.phi.Monomorium.sydneyense           -0.099580382  1.278996763
#&gt; inv.phi.Myrmecia.pilosula.complex       -0.365798148  1.379426991
#&gt; inv.phi.Notoncus.capitatus              -0.041865643  0.386476174
#&gt; inv.phi.Notoncus.ectatommoides          -0.083668931  4.065459654
#&gt; inv.phi.Nylanderia.sp..A                 0.107375074  1.411330351
#&gt; inv.phi.Ochetellus.glaber               -0.188660577  1.061062632
#&gt; inv.phi.Paraparatrechina.sp..B          -0.063958247  0.301738552
#&gt; inv.phi.Pheidole.sp..A                  -1.416183741 20.563608650
#&gt; inv.phi.Pheidole.sp..B                  -0.347953488  1.335394281
#&gt; inv.phi.Pheidole.sp..E                   0.320681647  2.691425226
#&gt; inv.phi.Pheidole.sp..J                  -0.276716452  0.798646265
#&gt; inv.phi.Polyrhachis.sp..A               -7.657667707 15.038423303
#&gt; inv.phi.Rhytidoponera.metallica.sp..A   -0.861735862 15.109175448
#&gt; inv.phi.Rhytidoponera.sp..B              0.003906426  1.352571722
#&gt; inv.phi.Solenopsis.sp..A                -1.918268093  4.168392024
#&gt; inv.phi.Stigmacros.sp..A                -0.028693059  1.050230029
#&gt; inv.phi.Tapinoma.sp..A                   0.106428053  2.278875227
#&gt; inv.phi.Tetramorium.sp..A               -0.300592717  3.634209779</div><div class='input'><span class='co'># Using Laplace approximation: (this line may take about 30 sec to run)</span>
<span class='no'>fitl0</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='no'>y</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"negative.binomial"</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"LA"</span>)
<span class='fu'>ordiplot</span>(<span class='no'>fitl0</span>)

<span class='co'># Poisson family:</span>
<span class='no'>fit.p</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='no'>y</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>poisson</a></span>(), <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"LA"</span>)
<span class='fu'>ordiplot</span>(<span class='no'>fit.p</span>)
<span class='co'># Use poisson model as a starting parameters for ZIP-model, this line may take few minutes to run</span>
<span class='no'>fit.z</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='no'>y</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"ZIP"</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"LA"</span>, <span class='kw'>start.fit</span> <span class='kw'>=</span> <span class='no'>fit.p</span>)
<span class='fu'>ordiplot</span>(<span class='no'>fit.z</span>)</div><div class='img'><img src='gllvm-5.png' alt='' width='700' height='433' /></div><div class='input'>

<span class='co'>## Example 2: gllvm with environmental variables</span>
<span class='co'># Fit model with two latent variables and all environmental covariates,</span>
<span class='no'>fitvX</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='kw'>formula</span> <span class='kw'>=</span> <span class='no'>y</span> ~ <span class='no'>X</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"negative.binomial"</span>)
<span class='fu'>ordiplot</span>(<span class='no'>fitvX</span>, <span class='kw'>biplot</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='fu'>coefplot</span>(<span class='no'>fitvX</span>)</div><div class='img'><img src='gllvm-6.png' alt='' width='700' height='433' /></div><div class='img'><img src='gllvm-7.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># Fit model with environmental covariates Bare.ground and Shrub.cover</span>
<span class='no'>fitvX2</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='no'>y</span>, <span class='no'>X</span>, <span class='kw'>formula</span> <span class='kw'>=</span> ~ <span class='no'>Bare.ground</span> + <span class='no'>Shrub.cover</span>,
 <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"negative.binomial"</span>)
<span class='fu'>ordiplot</span>(<span class='no'>fitvX2</span>)
<span class='fu'>coefplot</span>(<span class='no'>fitvX2</span>)</div><div class='img'><img src='gllvm-8.png' alt='' width='700' height='433' /></div><div class='img'><img src='gllvm-9.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># Use 5 initial runs and pick the best one</span>
<span class='no'>fitvX_5</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='no'>y</span>, <span class='no'>X</span>, <span class='kw'>formula</span> <span class='kw'>=</span> ~ <span class='no'>Bare.ground</span> + <span class='no'>Shrub.cover</span>,
 <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"negative.binomial"</span>, <span class='kw'>n.init</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>jitter.var</span> <span class='kw'>=</span> <span class='fl'>0.1</span>)
<span class='fu'>ordiplot</span>(<span class='no'>fitvX_5</span>)
<span class='fu'>coefplot</span>(<span class='no'>fitvX_5</span>)</div><div class='img'><img src='gllvm-10.png' alt='' width='700' height='433' /></div><div class='img'><img src='gllvm-11.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>## Example 3: Data in long format</span>
<span class='co'># Reshape data to long format:</span>
<span class='no'>datalong</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/reshape.html'>reshape</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span>(<span class='no'>y</span>,<span class='no'>X</span>)), <span class='kw'>direction</span> <span class='kw'>=</span> <span class='st'>"long"</span>,
                   <span class='kw'>varying</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span>(<span class='no'>y</span>), <span class='kw'>v.names</span> <span class='kw'>=</span> <span class='st'>"y"</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>datalong</span>)</div><div class='output co'>#&gt;     Bare.ground Canopy.cover Shrub.cover Volume.lying.CWD Feral.mammal.dung
#&gt; 1.1        9.00          3.5        0.50       0.03253833              0.20
#&gt; 2.1        6.00          0.0        0.00       0.01202944              0.65
#&gt; 3.1        9.25          0.0        8.10       0.00804195              0.00
#&gt; 4.1       23.25          0.0        0.25       0.00000000              0.20
#&gt; 5.1        8.75          0.0        3.35       0.00993944              0.35
#&gt; 6.1       32.25          0.0        0.00       0.03142221              1.00
#&gt;     time y id
#&gt; 1.1    1 0  1
#&gt; 2.1    1 0  2
#&gt; 3.1    1 0  3
#&gt; 4.1    1 4  4
#&gt; 5.1    1 2  5
#&gt; 6.1    1 0  6</div><div class='input'><span class='no'>fitvLong</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>datalong</span>, <span class='kw'>formula</span> <span class='kw'>=</span> <span class='no'>y</span> ~ <span class='no'>Bare.ground</span> + <span class='no'>Shrub.cover</span>,
               <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"negative.binomial"</span>)

<span class='co'>## Example 4: Fourth corner model</span>
<span class='co'># Fit fourth corner model with two latent variables</span>
<span class='no'>fitF1</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>y</span>, <span class='kw'>X</span> <span class='kw'>=</span> <span class='no'>X</span>, <span class='kw'>TR</span> <span class='kw'>=</span> <span class='no'>TR</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"negative.binomial"</span>)
<span class='fu'>coefplot</span>(<span class='no'>fitF1</span>)</div><div class='img'><img src='gllvm-12.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># Fourth corner can be plotted also with next lines</span>
<span class='co'>#fourth = fitF1$fourth.corner</span>
<span class='co'>#library(lattice)</span>
<span class='co'>#a = max( abs(fourth) )</span>
<span class='co'>#colort = colorRampPalette(c("blue","white","red"))</span>
<span class='co'>#plot.4th = levelplot(t(as.matrix(fourth)), xlab = "Environmental Variables",</span>
<span class='co'>#              ylab = "Species traits", col.regions = colort(100),</span>
<span class='co'>#              at = seq( -a, a, length = 100), scales = list( x = list(rot = 45)))</span>
<span class='co'>#print(plot.4th)</span>

<span class='co'># Specify model using formula</span>
<span class='no'>fitF2</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>y</span>, <span class='kw'>X</span> <span class='kw'>=</span> <span class='no'>X</span>, <span class='kw'>TR</span> <span class='kw'>=</span> <span class='no'>TR</span>,
 <span class='kw'>formula</span> <span class='kw'>=</span> ~ <span class='no'>Bare.ground</span> + <span class='no'>Canopy.cover</span> * (<span class='no'>Pilosity</span> + <span class='no'>Webers.length</span>),
 <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"negative.binomial"</span>)
<span class='fu'>ordiplot</span>(<span class='no'>fitF2</span>)</div><div class='img'><img src='gllvm-13.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'>coefplot</span>(<span class='no'>fitF2</span>)</div><div class='img'><img src='gllvm-14.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>## Example 5: Fit Tweedie model</span>
<span class='co'># Load coral data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>tikus</span>)
<span class='no'>ycoral</span> <span class='kw'>&lt;-</span> <span class='no'>tikus</span>$<span class='no'>abund</span>
<span class='co'># Let's consider only years 1981 and 1983</span>
<span class='no'>ycoral</span> <span class='kw'>&lt;-</span> <span class='no'>ycoral</span>[((<span class='no'>tikus</span>$<span class='no'>x</span>$<span class='no'>time</span> <span class='kw'>==</span> <span class='fl'>81</span>) + (<span class='no'>tikus</span>$<span class='no'>x</span>$<span class='no'>time</span> <span class='kw'>==</span> <span class='fl'>83</span>)) <span class='kw'>&gt;</span> <span class='fl'>0</span>, ]
<span class='co'># Exclude species which have observed at less than 4 sites</span>
<span class='no'>ycoral</span> <span class='kw'>&lt;-</span> <span class='no'>ycoral</span>[-<span class='fl'>17</span>, (<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span>(<span class='no'>ycoral</span> <span class='kw'>&gt;</span> <span class='fl'>0</span>) <span class='kw'>&gt;</span> <span class='fl'>3</span>)]
<span class='co'># Fit Tweedie model for coral data (this line may take few minutes to run)</span>
<span class='no'>fit.twe</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>ycoral</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"tweedie"</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"LA"</span>)
<span class='fu'>ordiplot</span>(<span class='no'>fit.twe</span>)</div><div class='img'><img src='gllvm-15.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>## Example 6: Random row effects</span>
<span class='no'>fitRand</span> <span class='kw'>&lt;-</span> <span class='fu'>gllvm</span>(<span class='no'>y</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"negative.binomial"</span>, <span class='kw'>row.eff</span> <span class='kw'>=</span> <span class='st'>"random"</span>)</div><div class='output co'>#&gt; Random row effects ended up to almost zero. Might be a false convergence or local maxima. You can try simpler model, less latent variables or change the optimizer. </div><div class='input'><span class='fu'>ordiplot</span>(<span class='no'>fitRand</span>, <span class='kw'>biplot</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='img'><img src='gllvm-16.png' alt='' width='700' height='433' /></div><div class='input'># }
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#note">Note</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Jenni Niku &lt;jenni.m.e.niku@jyu.fi&gt;, Wesley Brooks, Riki Herliansyah, Francis K.C. Hui, Sara Taskinen, David I. Warton</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Jenni Niku.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


