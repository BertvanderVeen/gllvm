<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Generalized Linear Latent Variable Models — gllvm • gllvm</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Generalized Linear Latent Variable Models — gllvm"><meta property="og:description" content="Fits generalized linear latent variable model for multivariate data. The model can be fitted using Laplace approximation method or variational
approximation method."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gllvm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/vignette1.html">Analysing multivariate abundance data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette2.html">Analysing high-dimensional microbial community data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette3.html">Introduction to gllvm Part 1: Ordination</a>
    </li>
    <li>
      <a href="../articles/vignette4.html">Introduction to gllvm Part 2: Species correlations</a>
    </li>
    <li>
      <a href="../articles/vignette5.html">How to use the quadratic response model</a>
    </li>
    <li>
      <a href="../articles/vignette6.html">Ordination with predictors</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/JenniNiku/gllvm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generalized Linear Latent Variable Models</h1>
    <small class="dont-index">Source: <a href="https://github.com/JenniNiku/gllvm/blob/HEAD/R/gllvm.R" class="external-link"><code>R/gllvm.R</code></a></small>
    <div class="hidden name"><code>gllvm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits generalized linear latent variable model for multivariate data. The model can be fitted using Laplace approximation method or variational
approximation method.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gllvm</span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  X <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  TR <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">family</span>,</span>
<span>  num.lv <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num.lv.c <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  num.RR <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  lv.formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lvCor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  studyDesign <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>  corWithin <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quadratic <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  row.eff <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sd.errors <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  offset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"VA"</span>,</span>
<span>  randomB <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  randomX <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dependent.row <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  beta0com <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  zeta.struc <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"probit"</span>,</span>
<span>  Power <span class="op">=</span> <span class="fl">1.1</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale.X <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  return.terms <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  gradient.check <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  disp.formula <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>reltol <span class="op">=</span> <span class="fl">1e-10</span>, reltol.c <span class="op">=</span> <span class="fl">1e-08</span>, TMB <span class="op">=</span> <span class="cn">TRUE</span>, optimizer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">(</span><span class="va">num.RR</span></span>
<span>    <span class="op">+</span> <span class="va">num.lv.c</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">randomB</span> <span class="op">!=</span> <span class="cn">FALSE</span>, <span class="st">"optim"</span>, <span class="st">"alabama"</span><span class="op">)</span>, max.iter <span class="op">=</span> <span class="fl">4000</span>, maxit <span class="op">=</span></span>
<span>    <span class="fl">4000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span>, optim.method <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  control.va <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Lambda.struc <span class="op">=</span> <span class="st">"unstructured"</span>, Ab.struct <span class="op">=</span> <span class="st">"unstructured"</span>, Ar.struc <span class="op">=</span></span>
<span>    <span class="st">"unstructured"</span>, diag.iter <span class="op">=</span> <span class="fl">1</span>, Ab.diag.iter <span class="op">=</span> <span class="fl">0</span>, Lambda.start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.3</span>, <span class="fl">0.3</span><span class="op">)</span>, NN</span>
<span>    <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  control.start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>starting.val <span class="op">=</span> <span class="st">"res"</span>, n.init <span class="op">=</span> <span class="fl">1</span>, n.init.max <span class="op">=</span> <span class="fl">10</span>, jitter.var <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    start.fit <span class="op">=</span> <span class="cn">NULL</span>, start.lvs <span class="op">=</span> <span class="cn">NULL</span>, randomX.start <span class="op">=</span> <span class="st">"zero"</span>, quad.start <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>    start.struc <span class="op">=</span> <span class="st">"LV"</span>, scalmax <span class="op">=</span> <span class="fl">10</span>, MaternKappa <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>  setMap <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>y</dt>
<dd><p>(n x m) matrix of responses.</p></dd>


<dt>X</dt>
<dd><p>matrix or data.frame of environmental covariates.</p></dd>


<dt>TR</dt>
<dd><p>matrix or data.frame of trait covariates.</p></dd>


<dt>data</dt>
<dd><p>data in long format, that is, matrix of responses, environmental and trait covariates and row index named as "id". When used, model needs to be defined using formula. This is alternative data input for y, X and TR.</p></dd>


<dt>formula</dt>
<dd><p>an object of class "formula" (or one that can be coerced to that class): a symbolic description of the model to be fitted (for fixed-effects predictors).</p></dd>


<dt>family</dt>
<dd><p>distribution function for responses. Options are <code>"negative.binomial"</code> (with log link), <code>poisson(link = "log")</code>, <code>binomial(link = "probit")</code> (and also with <code>link = "logit"</code> when <code>method = "LA"</code> or <code>method = "EVA"</code>), zero inflated poisson (<code>"ZIP"</code>), <code>gaussian(link = "identity")</code>, Tweedie (<code>"tweedie"</code>) (with log link, for <code>"LA"</code> and <code>"EVA"</code>-method), <code>"gamma"</code> (with log link), <code>"exponential"</code> (with log link), beta (<code>"beta"</code>) (with logit and probit link, for <code>"LA"</code> and  <code>"EVA"</code>-method) and <code>"ordinal"</code> (only with <code>"VA"</code>-method).</p></dd>


<dt>num.lv</dt>
<dd><p>number of latent variables, d, in gllvm model. Non-negative integer, less than number of response variables (m). Defaults to 2, if <code>num.lv.c=0</code> and <code>num.RR=0</code>, otherwise 0.</p></dd>


<dt>num.lv.c</dt>
<dd><p>number of latent variables, d, in gllvm model to constrain, with residual term. Non-negative integer, less than number of response (m) and equal to, or less than, the number of predictor variables (k). Defaults to 0. Requires specification of "lv.formula" in combination with "X" or "datayx". Can be used in combination with num.lv and fixed-effects, but not with traits.</p></dd>


<dt>num.RR</dt>
<dd><p>number of latent variables, d, in gllvm model to constrain, without residual term (reduced rank regression). Cannot yet be combined with traits.</p></dd>


<dt>lv.formula</dt>
<dd><p>an object of class "formula" (or one that can be coerced to that class): a symbolic description of the model to be fitted (for latent variables).</p></dd>


<dt>lvCor</dt>
<dd><p>(Under development, not to be used at the moment!) correlation structure for latent variables, defaults to <code>NULL</code> Correlation structure for latent variables can be defined via formula, eg. <code>~struc(1|groups)</code>, where option to 'struc' are <code>corAR1</code> (AR(1) covariance), <code>corExp</code> (exponentially decaying, see argument '<code>dist</code>') and <code>corCS</code> (compound symmetry). The grouping variable needs to be included either in 'X' or 'studyDesign'. Works at the moment only with unconstrained ordination without quadratic term.</p></dd>


<dt>studyDesign</dt>
<dd><p>variables related to eg. sampling/study design, used for defining correlation structure of the latent variables and row effects.</p></dd>


<dt>dist</dt>
<dd><p>matrix of coordinates or time points used for row parameters correlation structure <code>corExp</code>.</p></dd>


<dt>corWithin</dt>
<dd><p>logical. If <code>TRUE</code>, correlation is set between row effects of the observation units within group. Correlation and groups can be defined using <code>row.eff</code>. Defaults to <code>FALSE</code>, when correlation is set for row parameters between groups.</p></dd>


<dt>quadratic</dt>
<dd><p>either <code>FALSE</code>(default), <code>TRUE</code>, or <code>LV</code>. If <code>FALSE</code> models species responses as a linear function of the latent variables. If <code>TRUE</code> models species responses as a quadratic function of the latent variables. If <code>LV</code> assumes species all have the same quadratic coefficient per latent variable.</p></dd>


<dt>row.eff</dt>
<dd><p><code>FALSE</code>, <code>fixed</code>, <code>"random"</code> or formula to define the structure for the row parameters. Indicating whether row effects are included in the model as a fixed or as a random effects. Defaults to <code>FALSE</code> when row effects are not included. Structured random row effects can be defined via formula, eg. <code>~(1|groups)</code>, when unique row effects are set for each group, not for all rows, the grouping variable needs to be included in <code>X</code>. Correlation structure between random group effects/intercepts can also be set using <code>~struc(1|groups)</code>, where option to 'struc' are <code>corAR1</code> (AR(1) covariance), <code>corExp</code> (exponentially decaying, see argument '<code>dist</code>') and <code>corCS</code> (compound symmetry). Correlation structure can be set between or within groups, see argument '<code>corWithin</code>'.</p></dd>


<dt>sd.errors</dt>
<dd><p>logical. If <code>TRUE</code> (default) standard errors for parameter estimates are calculated.</p></dd>


<dt>offset</dt>
<dd><p>vector or matrix of offset terms.</p></dd>


<dt>method</dt>
<dd><p>model can be fitted using Laplace approximation method (<code>method = "LA"</code>) or variational approximation method (<code>method = "VA"</code>), or with extended variational approximation method (<code>method = "EVA"</code>) when VA is not applicable. If particular model has not been implemented using the selected method, model is fitted using the alternative method as a default. Defaults to <code>"VA"</code>.</p></dd>


<dt>randomB</dt>
<dd><p>either <code>FALSE</code>(default), "LV", "P", or "single". Fits concurrent or constrained ordination (i.e. models with num.lv.c or num.RR) with random slopes for the predictors. "LV" assumes LV-specific variance parameters, "P" predictor specific, and "single" the same across LVs and predictors.</p></dd>


<dt>randomX</dt>
<dd><p>formula for species specific random effects of environmental variables in fourth corner model. Defaults to <code>NULL</code>, when random slopes are not included.</p></dd>


<dt>dependent.row</dt>
<dd><p>logical. Whether or not random row effects are correlated (dependent) with the latent variables. Defaults to <code>FALSE</code> when correlation terms are not included.</p></dd>


<dt>beta0com</dt>
<dd><p>logical. If <code>FALSE</code> column-specific intercepts are assumed. If <code>TRUE</code>, a common intercept is used which is allowed only for fourth corner models.</p></dd>


<dt>zeta.struc</dt>
<dd><p>structure for cut-offs in the ordinal model. Either "common", for the same cut-offs for all species, or "species" for species-specific cut-offs. For the latter, classes are arbitrary per species, each category per species needs to have at least one observations. Defaults to "species".</p></dd>


<dt>plot</dt>
<dd><p>logical. If <code>TRUE</code> ordination plots will be printed in each iteration step when <code>TMB = FALSE</code>. Defaults to <code>FALSE</code>.</p></dd>


<dt>link</dt>
<dd><p>link function for binomial family if <code>method = "LA"</code> and beta family. Options are "logit" and "probit.</p></dd>


<dt>Power</dt>
<dd><p>fixed power parameter in Tweedie model. Scalar from interval (1,2). Defaults to 1.1.</p></dd>


<dt>seed</dt>
<dd><p>a single seed value, defaults to <code>NULL</code>.</p></dd>


<dt>scale.X</dt>
<dd><p>logical. If <code>TRUE</code>, covariates are scaled when fourth corner model is fitted.</p></dd>


<dt>return.terms</dt>
<dd><p>logical. If <code>TRUE</code> 'terms' object is returned.</p></dd>


<dt>gradient.check</dt>
<dd><p>logical. If <code>TRUE</code> gradients are checked for large values (&gt;0.01) even if the optimization algorithm did converge.</p></dd>


<dt>disp.formula</dt>
<dd><p>formula, or alternatively a vector of indices, for the grouping of dispersion parameters (e.g. in a negative-binomial distribution). Defaults to NULL so that all species have their own dispersion parameter. Is only allowed to include categorical variables. If a formula, data should be included as named rows in y.</p></dd>


<dt>control</dt>
<dd><p>A list with the following arguments controlling the optimization:</p><ul><li><p><em>reltol</em>:  convergence criteria for log-likelihood, defaults to 1e-8.</p></li>
<li><p><em>reltol.c</em>:  convergence criteria for equality constraints in ordination with predictors, defaults to 1e-8.</p></li>
<li><p><em>TMB</em>:  logical, if <code>TRUE</code> model will be fitted using Template Model Builder (TMB). TMB is always used if <code>method = "LA"</code>.  Defaults to <code>TRUE</code>.</p></li>
<li><p><em>optimizer</em>:  if <code>TMB=TRUE</code>, log-likelihood can be optimized using <code>"<a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a>"</code> (default) or <code>"<a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a>"</code>. For ordination with predictors (num.RR&gt;0 or num.lv.c&gt;0) this can additionally be one of <code>alabama</code>(default), <code>nloptr(agl)</code> or <code>nloptr(sqp)</code>.</p></li>
<li><p><em>max.iter</em>:  maximum number of iterations when <code>TMB = FALSE</code> or for <code>optimizer = "nlminb"</code> when <code>TMB = TRUE</code>, defaults to 4000.</p></li>
<li><p><em>maxit</em>:  maximum number of iterations for optimizer, defaults to 4000.</p></li>
<li><p><em>trace</em>:  logical, if <code>TRUE</code> in each iteration step information on current step will be printed. Defaults to <code>FALSE</code>. Only with <code>TMB = FALSE</code>.</p></li>
<li><p><em>optim.method</em>:  optimization method to be used if optimizer is <code>"<a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a>"</code>,<code>"alabama"</code>, or  <code>"nloptr"</code>, but the latter two are only available in combination with at least two latent variables (i.e., num.RR+num.lv.c&gt;1). Defaults to <code>"BFGS"</code>, but to <code>"L-BFGS-B"</code> for Tweedie family due the limited-memory use. For optimizer='alabama' this can be any <code>"<a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a>"</code> method, or  <code>"<a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a>"</code>. If optimizer = 'nloptr(agl)' this can be one of: "NLOPT_LD_CCSAQ", "NLOPT_LD_SLSQP", "NLOPT_LD_TNEWTON_PRECOND" (default), "NLOPT_LD_TNEWTON", "NLOPT_LD_MMA".</p></li>
</ul></dd>


<dt>control.va</dt>
<dd><p>A list with the following arguments controlling the variational approximation method:</p><ul><li><p><em>Lambda.struc</em>:  covariance structure of VA distributions for latent variables when <code>method = "VA"</code>, "unstructured" or "diagonal".</p></li>
<li><p><em>Ab.struct</em>:  covariance structure of VA distributions for random slopes when <code>method = "VA"</code>, "unstructured" or "diagonal".</p></li>
<li><p><em>diag.iter</em>:  non-negative integer which can sometimes be used to speed up the updating of variational (covariance) parameters in VA method. Can sometimes improve the accuracy. If <code>TMB = TRUE</code> either 0 or 1. Defaults to 1.</p></li>
<li><p><em>Ab.diag.iter</em>:  As above, but for variational covariance of random slopes.</p></li>
<li><p><em>Lambda.start</em>:  starting values for variances in VA distributions for latent variables, random row effects and random slopes in variational approximation method. Defaults to 0.3.</p></li>
<li><p><em>NN</em>:  Number of nearest neighbors for NN variational covariance. Defaults to ...</p></li>
</ul></dd>


<dt>control.start</dt>
<dd><p>A list with the following arguments controlling the starting values:</p><ul><li><p><em>starting.val</em>:  starting values can be generated by fitting model without latent variables, and applying factorial analysis to residuals to get starting values for latent variables and their coefficients (<code>starting.val = "res"</code>). Another options are to use zeros as a starting values (<code>starting.val = "zero"</code>) or initialize starting values for latent variables with (n x num.lv) matrix. Defaults to <code>"res"</code>, which is recommended.</p></li>
<li><p><em>n.init</em>:  number of initial runs. Uses multiple runs and picks up the one giving highest log-likelihood value. Defaults to 1.</p></li>
<li><p><em>n.init.max</em>:  maximum number of refits try try for n.init without improvement, defaults to 10.</p></li>
<li><p><em>start.fit</em>:  object of class 'gllvm' which can be given as starting parameters for count data (poisson, NB, or ZIP).</p></li>
<li><p><em>start.lvs</em>:  initialize starting values for latent variables with (n x num.lv) matrix. Defaults to <code>NULL</code>.</p></li>
<li><p><em>jitter.var</em>:  jitter variance for starting values of latent variables. Defaults to 0, meaning no jittering.</p></li>
<li><p><em>randomX.start</em>:  starting value method for the random slopes. Options are <code>"zero"</code> and <code>"res"</code>. Defaults to <code>"zero"</code>.</p></li>
<li><p><em>start.struc</em>:  starting value method for the quadratic term. Options are <code>"LV"</code> (default) and <code>"all"</code>.</p></li>
<li><p><em>quad.start</em>:  starting values for quadratic coefficients. Defaults to 0.01.</p></li>
<li><p><em>MaternKappa</em>:  Starting value for smoothness parameter kappa of Matern covariance function. Defaults to 3/2.</p></li>
<li><p><em>scalmax</em>:  Sets starting value for the range/scale parameter for the coordinates. Defaults to 10, when the starting value for scale parameter scales the coordinates between 0-10.</p></li>
</ul></dd>


<dt>setMap</dt>
<dd><p>UNDER DEVELOPMENT, DO NOT USE! list of a set of parameters to be fixed</p></dd>


<dt>...</dt>
<dd><p>Not used.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of class "gllvm" includes the following components:</p>
<dl><dt>call </dt>
<dd><p>function call</p></dd>

 <dt>y</dt>
<dd><p>(n x m) matrix of responses.</p></dd>

 <dt>X</dt>
<dd><p>matrix or data.frame of environmental covariates.</p></dd>

 <dt>lv.X</dt>
<dd><p>matrix or data.frame of environmental covariates for latent variables.</p></dd>

 <dt>TR</dt>
<dd><p>Trait matrix</p></dd>

 <dt>formula</dt>
<dd><p>Formula for predictors</p></dd>

 <dt>lv.formula</dt>
<dd><p>Formula of latent variables in constrained and concurrent ordination</p></dd>

 <dt>randomX </dt>
<dd><p>Formula for species specific random effects in fourth corner model</p></dd>

 <dt>randomB </dt>
<dd><p>Boolean flag for random slopes in constrained and concurrent ordination</p></dd>

 <dt>num.lv</dt>
<dd><p>Number of unconstrained latent variables</p></dd>

 <dt>num.lv.c</dt>
<dd><p>Number of latent variables in concurrent ordination</p></dd>

 <dt>num.RR</dt>
<dd><p>Number of latent variables in constrained ordination</p></dd>

 <dt>method</dt>
<dd><p>Method used for integration</p></dd>

 <dt>family</dt>
<dd><p>Response distribution</p></dd>

 <dt>row.eff</dt>
<dd><p>Type of row effect used</p></dd>

 <dt>n.init</dt>
<dd><p>Number of model runs for best fit</p></dd>

 <dt>disp.group</dt>
<dd><p>Groups for dispersion parameters</p></dd>

 <dt>sd </dt>
<dd><p>List of standard errors</p></dd>

 <dt>lvs </dt>
<dd><p>Latent variables</p></dd>

 <dt>params</dt>
<dd><p>List of parameters</p><ul><li><p>theta  latent variables' loadings relative to the diagonal entries of loading matrix</p></li>
<li><p>sigma.lv  diagonal entries of latent variables' loading matrix</p></li>
<li><p>LvXcoef  Predictor coefficients (or predictions for random slopes) related to latent variables, i.e. canonical coefficients</p></li>
<li><p>beta0  column specific intercepts</p></li>
<li><p>Xcoef  coefficients related to environmental covariates X</p></li>
<li><p>B  coefficients in fourth corner model</p></li>
<li><p>row.params  row-specific intercepts</p></li>
<li><p>phi  dispersion parameters \(\phi\) for negative binomial or Tweedie family, probability of zero inflation for ZIP family, standard deviation for gaussian family or shape parameter for gamma/beta family</p></li>
<li><p>inv.phi  dispersion parameters \(1/\phi\) for negative binomial</p></li>
</ul></dd>

 <dt>Power </dt>
<dd><p>power parameter \(\nu\) for Tweedie family</p></dd>

 <dt>sd </dt>
<dd><p>list of standard errors of parameters</p></dd>

 <dt>prediction.errors </dt>
<dd><p>list of prediction covariances for latent variables and variances for random row effects when method <code>"LA"</code> is used</p></dd>

 <dt>A, Ar, Ab_lv</dt>
<dd><p>covariance matrices for variational densities of latent variables, random row effects, and random slopes respectively</p></dd>

 <dt>seed</dt>
<dd><p>Seed used for calculating starting values</p></dd>

 <dt>TMBfn</dt>
<dd><p>TMB objective and derivative functions</p></dd>

 <dt>logL </dt>
<dd><p>log likelihood</p></dd>

 <dt>convergence </dt>
<dd><p>convergence code of optimizer</p></dd>

 <dt>quadratic </dt>
<dd><p>flag for quadratic model</p></dd>

 <dt>Hess </dt>
<dd><p>List holding matrices of second derivatives</p></dd>

 <dt>beta0com </dt>
<dd><p>Flag for common intercept in fourth corner models</p></dd>

 <dt>rstruc </dt>
<dd><p>Integer that indicates which type of row structure is included</p></dd>

 <dt>cstruc </dt>
<dd><p>Correlation structure for row effects</p></dd>

 <dt>dist </dt>
<dd><p>Matrix of coordinates or time points used for row effects</p></dd>

 <dt>terms </dt>
<dd><p>Terms object for main predictors</p></dd>

 <dt>start </dt>
<dd><p>starting values for model</p></dd>

 <dt>optim.method </dt>
<dd><p>Optimization method when using 'optim', 'alabama', or 'nloptr'</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Fits generalized linear latent variable models as in Hui et al. (2015 and 2017) and Niku et al. (2017).
Method can be used with two types of latent variable models depending on covariates. If only
site related environmental covariates are used, the expectation of response \(Y_{ij}\) is determined by</p>
<p>$$g(\mu_{ij}) = \eta_{ij} = \alpha_i + \beta_{0j} + x_i'\beta_j + u_i'\theta_j,$$</p>
<p>where \(g(.)\) is a known link function, \(u_i\) are \(d\)-variate latent variables (\(d\)&lt;&lt;\(m\)), \(\alpha_i\) is an optional row effect
at site \(i\), and it can be fixed or random effect (also other structures are possible, see below), \(\beta_{0j}\) is an intercept term for species \(j\), \(\beta_j\) and \(\theta_j\) are column
specific coefficients related to covariates and the latent variables, respectively.</p>
<div class="section">
<h3 id="quadratic-model">Quadratic model<a class="anchor" aria-label="anchor" href="#quadratic-model"></a></h3>
<p>Alternatively, a more complex version of the model can be fitted with <code>quadratic = TRUE</code>, where species are modeled as a quadratic function of the latent variables:
$$g(\mu_{ij}) = \eta_{ij} = \alpha_i + \beta_{0j} + x_i'\beta_j + u_i'\theta_j - u_i' D_j u_i$$.
Here, D_j is a diagonal matrix of positive only quadratic coefficients, so that the model generates concave shapes only. This implementation follows
the ecological theoretical model where species are generally recognized to exhibit non-linear response curves.
For a model with quadratic responses, quadratic coefficients are assumed to be the same for all species: $$D_j = D$$. This model requires less information
per species and can be expected to be more applicable to most datasets. The quadratic coefficients D can be used to calculate the length of 
ecological gradients.
For quadratic responses, it can be useful to provide the latent variables estimated with a GLLVM with linear responses, or estimated with (Detrended) Correspondence Analysis.
The latent variables can then be passed to the <code>start.lvs</code> argument inside the <code>control.start</code> list, which in many cases gives good results.</p>
</div>

<div class="section">
<h3 id="ordination-with-predictors">Ordination with predictors<a class="anchor" aria-label="anchor" href="#ordination-with-predictors"></a></h3>
<p>For GLLVMs with both linear and quadratic response model, a series of predictors \(x_lv\) can be included to explain the latent variables:</p>
<p>$$g(\mu_{ij}) = \alpha_i + \beta_{0j} + x_i'\beta_j + (B' x_{lv,i} + \epsilon_i)' \gamma_j - (B' x_{lv,i})' D_j (B' x_{lv,i} + \epsilon_i) ,$$
where \(z_i = B' x_{lv,i} + \epsilon_i\) are latent variables informed by the predictors, but not constrained compared to unconstrained ordination as in methods such as CCA or RDA.
Omitting the predictors results in an unconstrained ordination, and omitting \(\epsilon_i\) in the usual constrained ordination, which can also be fitted.</p>
</div>

<div class="section">
<h3 id="fourth-corner-model">Fourth corner model<a class="anchor" aria-label="anchor" href="#fourth-corner-model"></a></h3>
<p>An alternative model is the fourth corner model (Brown et al., 2014, Warton et al., 2015) which will be fitted if also trait covariates
are included. The expectation of response \(Y_{ij}\) is</p>
<p>$$g(\mu_{ij}) = \alpha_i + \beta_{0j} + x_i'(\beta_x + b_j) + TR_j'\beta_t + vec(B)*kronecker(TR_j,X_i) + u_i'\theta_j - u_i'D_ju_i$$</p>
<p>where g(.), \(u_i\), \(\beta_{0j}\) and \(\theta_j\) are defined as above. Vectors \(\beta_x\) and \(\beta_t\) are the main effects
or coefficients related to environmental and trait covariates, respectively, matrix \(B\) includes interaction terms. Vectors \(b_j\) are 
optional species-specific random slopes for environmental covariates.
The interaction/fourth corner terms are optional as well as are the main effects of trait covariates.</p>
</div>

<div class="section">
<h3 id="structured-row-effects">Structured row effects<a class="anchor" aria-label="anchor" href="#structured-row-effects"></a></h3>
<p>In addition to the site-specific random effects, \(\alpha_i\), it is also possible to set arbitrary structure/design for the row effects. 
That is, assume that observations / rows \(i=1,...,n\) in the data matrix are from groups \(t=1,...,T\), so that each row \(i\) belongs to one of the groups, denote \(G(i) \in \{1,...,T\}\). Each group \(t\) has a number of observations \(n_t\), so that \(\sum_{t=1}^{T} n_t =n\).
Now we can set random intercept for each group \(t\), (see argument '<code>row.eff</code>'):</p>
<p>$$g(\mu_{ij}) = \eta_{ij} = \alpha_{G(i)} + \beta_{0j} + x_i'\beta_j + u_i'\theta_j,$$</p> 
<p>There is also a possibility to set correlation structure for the random intercepts between groups, so that \((\alpha_{1},...,\alpha_{T})^\top \sim N(0, \Sigma_r)\). That might be the case, for example, when the groups are spatially or temporally dependent.
 Another option is to set row specific random intercepts \(\alpha_i\), but to set the correlation structure for the observations within groups, (see argument '<code>corWithin</code>'). That is, we can set \(corr(\alpha_{i},\alpha_{i'}) = C(i,i') \neq 0\) according to some correlation function \(C\), when \(G(i)=G(i')\).
 This model is restricted to the case, where each group has equal number of observations (rows), that is \(n_t=n_{t'}\) for all \(t,t' \in \{1,...,T\}\).</p> 
<p>The correlation structures available in the package are</p><ul><li><p><code>corAR1</code>  autoregressive process of order 1.</p></li>
<li><p><code>corExp</code>  exponentially decaying, see argument '<code>dist</code>'.</p></li>
<li><p><code>corCS</code>  compound symmetry.</p></li>
</ul></div>

<div class="section">
<h3 id="starting-values">Starting values<a class="anchor" aria-label="anchor" href="#starting-values"></a></h3>
<p>The method is sensitive for the choices of initial values of the latent variables. Therefore it is
recommendable to use multiple runs and pick up the one giving the highest log-likelihood value (see argument '<code>n.init</code>').
However, sometimes this is computationally too demanding, and default option
<code>starting.val = "res"</code> is recommended. For more details on different starting value methods, see Niku et al., (2018).</p>
</div><p>Models are implemented using TMB (Kristensen et al., 2015) applied to variational approximation (Hui et al., 2017), extended variational approximation (Korhonen et al., 2021) and Laplace approximation (Niku et al., 2017).</p>
<p>With ordinal family response classes must start from 0 or 1.</p>
<div class="section">
<h3 id="distributions">Distributions<a class="anchor" aria-label="anchor" href="#distributions"></a></h3>


<p>Mean and variance for distributions are defined as follows.</p><ul><li><p>For count data <code>family = poisson()</code>: Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(\mu_{ij}) = \mu_{ij}\), or</p></li>
<li><p><code>family = "negative.binomial"</code>: Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(\mu_{ij}) = \mu_{ij}+\mu_{ij}^2\phi_j\), or</p></li>
<li><p><code>family = "ZIP"</code>: Expectation \(E[Y_{ij}] = (1-p)\mu_{ij}\), variance \(V(\mu_{ij}) = \mu_{ij}(1-p)(1+\mu_{ij}p)\).</p></li>
<li><p>For binary data <code>family = binomial()</code>: Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(\mu_{ij}) = \mu_{ij}(1-\mu_{ij})\).</p></li>
<li><p>For percent cover data \(0 &lt; Y_{ij} &lt; 1\) <code>family = "beta"</code>: Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(\mu_{ij}) = \mu_{ij}(1-\mu_{ij})//(1+\phi_j)\).</p></li>
<li><p>For positive continuous data <code>family = "gamma"</code>:Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(\mu_{ij}) = \mu_{ij}^2/\phi_j\), where \(\phi_j\) is species specific shape parameter.</p></li>
<li><p>For non-negative  continuous data <code>family = "exponential"</code>:Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(\mu_{ij}) = \mu_{ij}^2\).</p></li>
<li><p>For non-negative continuous or biomass data <code>family = "tweedie"</code> Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(\mu_{ij}) = \phi_j*\mu_{ij}^\nu\), where \(\nu\) is a power parameter of Tweedie distribution. See details Dunn and Smyth (2005).</p></li>
<li><p>For ordinal data <code>family = "ordinal"</code>: Cumulative probit model, see Hui et.al. (2016).</p></li>
<li><p>For normal distributed data <code>family = gaussian()</code>: Expectation \(E[Y_{ij}] = \mu_{ij}\), variance \(V(y_{ij}) = \phi_j^2.\)</p></li>
</ul></div>

    </div>
    <div id="note">
    <h2>Note</h2>
    <p>If function gives warning: 'In f(x, order = 0) : value out of range in 'lgamma'', optimizer have visited an area where gradients become too big. It is automatically fixed by trying another step in the optimization process, and can be ignored if errors do not occur.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Brown, A. M., Warton, D. I., Andrew, N. R., Binns, M., Cassis, G., and Gibb, H. (2014). The fourth-corner solution - using predictive models to understand how species traits interact with the environment. Methods in Ecology and Evolution, 5:344-352.</p>
<p>Dunn, P. K. and Smyth, G. K. (2005).  Series evaluation of tweedie exponential dispersion model densities. Statistics and Computing, 15:267-280.</p>
<p>Hui, F. K. C., Taskinen, S., Pledger, S., Foster, S. D., and Warton, D. I. (2015).  Model-based approaches to unconstrained ordination. Methods in Ecology and Evolution, 6:399-411.</p>
<p>Hui, F. K. C., Warton, D., Ormerod, J., Haapaniemi, V., and Taskinen, S. (2017).  Variational approximations for generalized linear latent variable models. Journal of Computational and Graphical Statistics. Journal of Computational and Graphical Statistics, 26:35-43.</p>
<p>Kasper Kristensen, Anders Nielsen, Casper W. Berg, Hans Skaug, Bradley M. Bell (2016). TMB: Automatic Differentiation and Laplace Approximation. Journal of Statistical Software, 70(5), 1-21.</p>
<p>Korhonen, P., Hui, F. K. C., Niku, J., and Taskinen, S. (2021). Fast, universal estimation of latent variable models using extended variational approximations. Submitted.</p>
<p>Niku, J., Warton,  D. I., Hui, F. K. C., and Taskinen, S. (2017). Generalized linear latent variable models for multivariate count and biomass data in ecology. Journal of Agricultural, Biological, and Environmental Statistics, 22:498-522.</p>
<p>Niku, J., Brooks, W., Herliansyah, R., Hui, F. K. C., Taskinen, S., and Warton,  D. I. (2018). Efficient estimation of generalized linear latent variable models. PLoS One, 14(5):1-20.</p>
<p>Warton, D. I., Guillaume Blanchet, F., O'Hara, R. B., Ovaskainen, O., Taskinen, S., Walker, S. C. and Hui, F. K. C. (2015). So many variables: Joint modeling in community ecology. Trends in Ecology &amp; Evolution, 30:766-779.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="coefplot.gllvm.html">coefplot.gllvm</a></code>, <code><a href="confint.gllvm.html">confint.gllvm</a></code>, <code><a href="ordiplot.gllvm.html">ordiplot.gllvm</a></code>, <code><a href="plot.gllvm.html">plot.gllvm</a></code>, <code><a href="summary.gllvm.html">summary.gllvm</a></code>.</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Jenni Niku &lt;jenni.m.e.niku@jyu.fi&gt;, Wesley Brooks, Riki Herliansyah, Francis K.C. Hui, Pekka Korhonen, Sara Taskinen, Bert van der Veen, David I. Warton</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Extract subset of the microbial data to be used as an example</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">microbialdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">microbialdata</span><span class="op">$</span><span class="va">Xenv</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">microbialdata</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">microbialdata</span><span class="op">$</span><span class="va">Y</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                     decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">21</span><span class="op">:</span><span class="fl">40</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, formula <span class="op">=</span> <span class="op">~</span> <span class="va">pH</span> <span class="op">+</span> <span class="va">Phosp</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span><span class="op">$</span><span class="va">logL</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -4012.184</span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="coefplot.gllvm.html">coefplot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Inclusion of structured random row effect</span></span></span>
<span class="r-in"><span><span class="va">sDesign</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Site <span class="op">=</span> <span class="va">microbialdata</span><span class="op">$</span><span class="va">Xenv</span><span class="op">$</span><span class="va">Site</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, formula <span class="op">=</span> <span class="op">~</span> <span class="va">pH</span> <span class="op">+</span> <span class="va">Phosp</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>            studyDesign<span class="op">=</span><span class="va">sDesign</span>, row.eff<span class="op">=</span><span class="op">~</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">Site</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Load a dataset from the mvabund package</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mvabund</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">antTraits</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">antTraits</span><span class="op">$</span><span class="va">abund</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">antTraits</span><span class="op">$</span><span class="va">env</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">TR</span> <span class="op">&lt;-</span> <span class="va">antTraits</span><span class="op">$</span><span class="va">traits</span></span></span>
<span class="r-in"><span><span class="co"># Fit model with environmental covariates Bare.ground and Shrub.cover</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, formula <span class="op">=</span> <span class="op">~</span> <span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Shrub.cover</span>,</span></span>
<span class="r-in"><span>            family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="coefplot.gllvm.html">coefplot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-3.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="gllvm-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example 1: Fit model with two unconstrained latent variables</span></span></span>
<span class="r-in"><span><span class="co"># Using variational approximation:</span></span></span>
<span class="r-in"><span><span class="va">fitv0</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span><span class="va">y</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, method <span class="op">=</span> <span class="st">"VA"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fitv0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitv0</span>, mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-5.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="gllvm-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitv0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gllvm(y = y, family = "negative.binomial", method = "VA")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family:  negative.binomial </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC:  4056.17 AICc:  4106.324 BIC:  4889.878 LL:  -1865.1 df:  163 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Informed LVs:  0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Constrained LVs:  0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unconstrained LVs:  2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula:  ~ 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> LV formula:  ~ 0 </span>
<span class="r-in"><span><span class="fu"><a href="confint.gllvm.html">confint</a></span><span class="op">(</span><span class="va">fitv0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                2.5 %      97.5 %</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.1                             -0.103402980  1.85209471</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.2                              1.079390136  4.48661491</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.3                              1.000000000  1.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.4                             -3.379422295  3.62595070</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.5                             -1.025008632  2.94427132</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.6                             -0.680114853  1.55135267</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.7                             -0.460504040  2.15554108</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.8                             -2.598759821  1.44251518</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.9                             -0.925156631  2.07074861</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.10                            -6.330042006  1.22346719</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.11                            -1.596799409  5.82131884</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.12                            -0.558999059  0.96186360</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.13                            -0.996498330  1.38189846</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.14                            -0.701998735  2.72666242</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.15                            -1.199375887  0.16129878</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.16                            -1.113193570  4.02103912</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.17                            -1.111807089  0.73438881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.18                            -0.653702645  1.48928169</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.19                            -1.786913961  0.71772167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.20                            -0.929285742  1.19702793</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.21                            -1.537465674  0.27177114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.22                            -2.294953626  0.40783190</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.23                            -3.206166143  1.07799836</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.24                            -0.369266020  1.80942316</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.25                            -3.337895668  1.20608250</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.26                            -2.428403704  0.63909824</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.27                            -1.106519074  1.40692222</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.28                            -1.364340574  4.41838881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.29                            -2.056345947  0.22273149</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.30                            -2.568657094  0.76612817</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.31                            -3.333724639  1.97963577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.32                            -4.795738669  1.56302890</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.33                            -1.016328098  0.15474535</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.34                            -1.695070660  1.09685446</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.35                            -0.211673812  1.10215683</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.36                            -1.669777851  1.01392644</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.37                            -0.597232002  1.33888004</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.38                            -0.988171051  0.19280571</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.39                            -2.776950908  0.49048366</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.40                            -1.880887153  0.67554519</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV1.41                            -0.524963966  2.41543700</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.1                             -0.374854967  1.19501151</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.2                             -2.481864379  0.61506892</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.3                              0.000000000  0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.4                              1.000000000  1.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.5                             -0.245282502  0.60985168</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.6                             -0.058102889  0.36367605</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.7                             -0.652064409  0.04135081</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.8                             -0.107750146  0.67630191</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.9                             -0.151880858  0.42728089</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.10                            -1.417893694  0.76104774</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.11                            -0.322576823  1.41237197</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.12                            -0.392872691 -0.01051717</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.13                            -0.634629512 -0.10044290</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.14                            -0.503773257  0.43427315</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.15                            -0.161918860  0.20511840</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.16                            -0.222045268  0.87898796</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.17                            -0.471089023 -0.09686049</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.18                            -0.556085282  0.01519299</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.19                            -0.631730090  0.04549073</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.20                            -0.483940962  0.17680169</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.21                            -0.364008288  0.10592356</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.22                            -0.512858745  0.19539402</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.23                            -0.932525769  0.21015192</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.24                            -0.116329565  0.37738204</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.25                            -1.114257011 -0.04363455</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.26                            -0.696858651  0.13944219</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.27                            -0.721248429  0.18280806</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.28                            -0.423291133  0.70856138</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.29                            -0.373191768  0.22476573</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.30                            -0.756379036  0.04834274</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.31                            -1.545301412  0.10748053</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.32                            -0.308190479  0.93105815</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.33                            -0.211209702  0.07114561</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.34                            -0.014516526  0.58036466</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.35                            -0.254181170  0.10729438</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.36                            -0.289206699  0.68832197</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.37                            -0.263563276  0.21021287</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.38                            -0.242052939  0.03958539</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.39                            -0.621802684  0.17297255</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.40                            -0.301122241  0.46366339</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> theta.LV2.41                            -0.299619108  0.35766324</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma.LV1                               -0.362692213  0.04900734</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma.LV2                               -0.709728813  0.06393158</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Amblyopone.australis          -1.854130375 -0.03146858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Aphaenogaster.longiceps       -6.254061763 -0.31855900</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Camponotus.cinereus.amperei   -3.697224995 -0.83558987</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Camponotus.claripes           -0.036318061  1.06033485</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Camponotus.consobrinus         0.642062961  1.79314437</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Camponotus.nigriceps          -1.679423524  0.47989181</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Camponotus.nigroaeneus        -1.317217573  0.23418832</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Cardiocondyla.nuda.atalanta   -5.332810860 -0.01410368</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Crematogaster.sp..A           -4.739923617  0.10305160</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Heteroponera.sp..A             0.802084665  1.67639321</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Iridomyrmex.bicknelli          0.772258917  1.80399705</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Iridomyrmex.dromus            -1.858703912  0.26234784</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Iridomyrmex.mjobergi           0.981649320  1.68323139</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Iridomyrmex.purpureus         -1.286991396  1.11354437</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Iridomyrmex.rufoniger          2.021575806  2.70256295</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Iridomyrmex.suchieri          -0.135376505  1.04238328</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Iridomyrmex.suchieroides      -1.136086519  0.24755192</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Melophorus.sp..E              -2.009286928 -0.37474358</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Melophorus.sp..F               0.082321961  0.98209174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Melophorus.sp..H              -1.273630762  0.15972237</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Meranoplus.sp..A              -1.455510711  0.64781264</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Monomorium.leae                0.841792459  1.84761393</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Monomorium.rothsteini         -0.732314216  1.20870408</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Monomorium.sydneyense         -1.321301583  0.40682771</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Myrmecia.pilosula.complex     -2.053797233 -0.20212910</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Notoncus.capitatus            -2.472676330  0.53497723</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Notoncus.ectatommoides         0.238812787  1.22210879</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Nylanderia.sp..A               0.029654837  1.46945955</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Ochetellus.glaber             -3.867024399 -0.21668080</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Paraparatrechina.sp..B        -3.311622783  0.27491158</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Pheidole.sp..A                 2.092275230  2.54352830</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Pheidole.sp..B                -2.030025100 -0.15315592</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Pheidole.sp..E                 1.226607907  1.97949317</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Pheidole.sp..J                -2.978045558 -0.56709019</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Polyrhachis.sp..A             -1.984380730 -0.52863578</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Rhytidoponera.metallica.sp..A  1.772500862  2.27327756</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Rhytidoponera.sp..B           -0.397726458  1.09367602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Solenopsis.sp..A              -3.427244508 -0.97581865</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Stigmacros.sp..A              -1.091136527  0.51312534</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Tapinoma.sp..A                 0.282474676  1.23734074</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Intercept.Tetramorium.sp..A             -0.632363820  0.77823989</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Amblyopone.australis            -0.270628342  1.34913110</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Aphaenogaster.longiceps         -0.211390715  1.00820996</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Camponotus.cinereus.amperei     -1.083963833  2.59055084</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Camponotus.claripes              0.057455544  1.51941020</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Camponotus.consobrinus           0.052951692  3.83190609</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Camponotus.nigriceps            -0.061322921  0.51813191</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Camponotus.nigroaeneus          -0.106605989  1.07140704</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Cardiocondyla.nuda.atalanta     -0.070027937  0.42283510</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Crematogaster.sp..A             -0.079418142  0.52849709</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Heteroponera.sp..A               0.225128519  2.46914685</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Iridomyrmex.bicknelli           -0.118360071  5.03127043</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Iridomyrmex.dromus              -0.066758874  0.56596797</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Iridomyrmex.mjobergi            -0.170243782  4.83911946</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Iridomyrmex.purpureus            0.009088981  0.42277825</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Iridomyrmex.rufoniger           -0.083946135 19.14122092</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Iridomyrmex.suchieri            -0.154662398  2.35759552</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Iridomyrmex.suchieroides        -0.884267680  4.74589941</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Melophorus.sp..E                -0.832125944  2.32020924</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Melophorus.sp..F                -0.512500561  5.30111123</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Melophorus.sp..H                -0.424271869  3.55633191</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Meranoplus.sp..A                -0.018463930  0.63755791</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Monomorium.leae                  0.248442947  1.69123759</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Monomorium.rothsteini            0.014799748  2.74653276</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Monomorium.sydneyense           -0.099539892  1.27892096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Myrmecia.pilosula.complex       -0.365780338  1.37931308</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Notoncus.capitatus              -0.041823964  0.38604889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Notoncus.ectatommoides          -0.084226317  4.06991524</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Nylanderia.sp..A                 0.107361852  1.41119666</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Ochetellus.glaber               -0.188663348  1.06096635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Paraparatrechina.sp..B          -0.063992215  0.30186155</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Pheidole.sp..A                  -1.417082010 20.56666906</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Pheidole.sp..B                  -0.348509058  1.33685563</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Pheidole.sp..E                   0.320683579  2.69279916</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Pheidole.sp..J                  -0.276764070  0.79870257</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Polyrhachis.sp..A               -7.666852134 15.05228224</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Rhytidoponera.metallica.sp..A   -0.858504369 15.09456969</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Rhytidoponera.sp..B              0.003913888  1.35248291</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Solenopsis.sp..A                -1.919015324  4.16967260</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Stigmacros.sp..A                -0.028705407  1.05040362</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Tapinoma.sp..A                   0.106426058  2.27928779</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> inv.phi.Tetramorium.sp..A               -0.300539168  3.63488768</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example 1a: Fit concurrent ordination model with two latent variables and with </span></span></span>
<span class="r-in"><span><span class="co"># quadratic response model</span></span></span>
<span class="r-in"><span><span class="co"># We scale and centre the  predictors to improve convergence</span></span></span>
<span class="r-in"><span><span class="va">fity1</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span><span class="va">y</span>, X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, </span></span>
<span class="r-in"><span>              num.lv.c<span class="op">=</span><span class="fl">2</span>, method<span class="op">=</span><span class="st">"VA"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fity1</span>, biplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using Laplace approximation: (this line may take about 30 sec to run)</span></span></span>
<span class="r-in"><span><span class="va">fitl0</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span><span class="va">y</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, method <span class="op">=</span> <span class="st">"LA"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fitl0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Poisson family:</span></span></span>
<span class="r-in"><span><span class="va">fit.p</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span><span class="va">y</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"LA"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fit.p</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Use poisson model as a starting parameters for ZIP-model, this line </span></span></span>
<span class="r-in"><span><span class="co"># may take few minutes to run</span></span></span>
<span class="r-in"><span><span class="va">fit.z</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span><span class="va">y</span>, family <span class="op">=</span> <span class="st">"ZIP"</span>, method <span class="op">=</span> <span class="st">"LA"</span>, </span></span>
<span class="r-in"><span>              control.start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>start.fit <span class="op">=</span> <span class="va">fit.p</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fit.z</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example 2: gllvm with environmental variables</span></span></span>
<span class="r-in"><span><span class="co"># Fit model with two latent variables and all environmental covariates,</span></span></span>
<span class="r-in"><span><span class="va">fitvX</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">X</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fitvX</span>, biplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="coefplot.gllvm.html">coefplot</a></span><span class="op">(</span><span class="va">fitvX</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-8.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="gllvm-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Fit model with environmental covariates Bare.ground and Shrub.cover</span></span></span>
<span class="r-in"><span><span class="va">fitvX2</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, formula <span class="op">=</span> <span class="op">~</span> <span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Shrub.cover</span>,</span></span>
<span class="r-in"><span> family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fitvX2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="coefplot.gllvm.html">coefplot</a></span><span class="op">(</span><span class="va">fitvX2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-10.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="gllvm-11.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Use 5 initial runs and pick the best one</span></span></span>
<span class="r-in"><span><span class="va">fitvX_5</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, formula <span class="op">=</span> <span class="op">~</span> <span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Shrub.cover</span>,</span></span>
<span class="r-in"><span> family <span class="op">=</span> <span class="st">"negative.binomial"</span>, control.start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n.init <span class="op">=</span> <span class="fl">5</span>, jitter.var <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fitvX_5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="coefplot.gllvm.html">coefplot</a></span><span class="op">(</span><span class="va">fitvX_5</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-12.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="gllvm-13.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example 3: Data in long format</span></span></span>
<span class="r-in"><span><span class="co"># Reshape data to long format:</span></span></span>
<span class="r-in"><span><span class="va">datalong</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y</span>,<span class="va">X</span><span class="op">)</span><span class="op">)</span>, direction <span class="op">=</span> <span class="st">"long"</span>,</span></span>
<span class="r-in"><span>                   varying <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, v.names <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">datalong</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Bare.ground Canopy.cover Shrub.cover Volume.lying.CWD Feral.mammal.dung</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.1        9.00          3.5        0.50       0.03253833              0.20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.1        6.00          0.0        0.00       0.01202944              0.65</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3.1        9.25          0.0        8.10       0.00804195              0.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4.1       23.25          0.0        0.25       0.00000000              0.20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5.1        8.75          0.0        3.35       0.00993944              0.35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6.1       32.25          0.0        0.00       0.03142221              1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     time y id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.1    1 0  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.1    1 0  2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3.1    1 0  3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4.1    1 4  4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5.1    1 2  5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6.1    1 0  6</span>
<span class="r-in"><span><span class="va">fitvLong</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span>data <span class="op">=</span> <span class="va">datalong</span>, formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Shrub.cover</span>,</span></span>
<span class="r-in"><span>               family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example 4: Fourth corner model</span></span></span>
<span class="r-in"><span><span class="co"># Fit fourth corner model with two latent variables</span></span></span>
<span class="r-in"><span><span class="va">fitF1</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, X <span class="op">=</span> <span class="va">X</span>, TR <span class="op">=</span> <span class="va">TR</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="coefplot.gllvm.html">coefplot</a></span><span class="op">(</span><span class="va">fitF1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-14.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Fourth corner can be plotted also with next lines</span></span></span>
<span class="r-in"><span><span class="co">#fourth = fitF1$fourth.corner</span></span></span>
<span class="r-in"><span><span class="co">#library(lattice)</span></span></span>
<span class="r-in"><span><span class="co">#a = max( abs(fourth) )</span></span></span>
<span class="r-in"><span><span class="co">#colort = colorRampPalette(c("blue","white","red"))</span></span></span>
<span class="r-in"><span><span class="co">#plot.4th = levelplot(t(as.matrix(fourth)), xlab = "Environmental Variables",</span></span></span>
<span class="r-in"><span><span class="co">#              ylab = "Species traits", col.regions = colort(100),</span></span></span>
<span class="r-in"><span><span class="co">#              at = seq( -a, a, length = 100), scales = list( x = list(rot = 45)))</span></span></span>
<span class="r-in"><span><span class="co">#print(plot.4th)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specify model using formula</span></span></span>
<span class="r-in"><span><span class="va">fitF2</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, X <span class="op">=</span> <span class="va">X</span>, TR <span class="op">=</span> <span class="va">TR</span>,</span></span>
<span class="r-in"><span> formula <span class="op">=</span> <span class="op">~</span> <span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Canopy.cover</span> <span class="op">*</span> <span class="op">(</span><span class="va">Pilosity</span> <span class="op">+</span> <span class="va">Webers.length</span><span class="op">)</span>,</span></span>
<span class="r-in"><span> family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fitF2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-15.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="coefplot.gllvm.html">coefplot</a></span><span class="op">(</span><span class="va">fitF2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-16.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Include species specific random slopes to the fourth corner model</span></span></span>
<span class="r-in"><span><span class="va">fitF3</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, X <span class="op">=</span> <span class="va">X</span>, TR <span class="op">=</span> <span class="va">TR</span>,</span></span>
<span class="r-in"><span> formula <span class="op">=</span> <span class="op">~</span> <span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Canopy.cover</span> <span class="op">*</span> <span class="op">(</span><span class="va">Pilosity</span> <span class="op">+</span> <span class="va">Webers.length</span><span class="op">)</span>,</span></span>
<span class="r-in"><span> family <span class="op">=</span> <span class="st">"negative.binomial"</span>, randomX <span class="op">=</span> <span class="op">~</span> <span class="va">Bare.ground</span> <span class="op">+</span> <span class="va">Canopy.cover</span>, </span></span>
<span class="r-in"><span> control.start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>n.init <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fitF3</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-17.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="coefplot.gllvm.html">coefplot</a></span><span class="op">(</span><span class="va">fitF3</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-18.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example 5: Fit Tweedie model</span></span></span>
<span class="r-in"><span><span class="co"># Load coral data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tikus</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ycoral</span> <span class="op">&lt;-</span> <span class="va">tikus</span><span class="op">$</span><span class="va">abund</span></span></span>
<span class="r-in"><span><span class="co"># Let's consider only years 1981 and 1983</span></span></span>
<span class="r-in"><span><span class="va">ycoral</span> <span class="op">&lt;-</span> <span class="va">ycoral</span><span class="op">[</span><span class="op">(</span><span class="op">(</span><span class="va">tikus</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">81</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">tikus</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">83</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># Exclude species which have observed at less than 4 sites</span></span></span>
<span class="r-in"><span><span class="va">ycoral</span> <span class="op">&lt;-</span> <span class="va">ycoral</span><span class="op">[</span><span class="op">-</span><span class="fl">17</span>, <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">ycoral</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># Fit Tweedie model for coral data (this line may take few minutes to run)</span></span></span>
<span class="r-in"><span><span class="va">fit.twe</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span>y <span class="op">=</span> <span class="va">ycoral</span>, family <span class="op">=</span> <span class="st">"tweedie"</span>, method <span class="op">=</span> <span class="st">"LA"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fit.twe</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-19.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Example 6: Random row effects</span></span></span>
<span class="r-in"><span><span class="va">fitRand</span> <span class="op">&lt;-</span> <span class="fu">gllvm</span><span class="op">(</span><span class="va">y</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, row.eff <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fitRand</span>, biplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="gllvm-20.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jenni Niku, Wesley Brooks, Riki Herliansyah, Francis K.C. Hui, Pekka Korhonen, Sara Taskinen, Bert van der Veen, David I. Warton.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

