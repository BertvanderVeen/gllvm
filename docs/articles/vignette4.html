<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to gllvm Part 2: Species correlations • gllvm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to gllvm Part 2: Species correlations">
<meta property="og:description" content="gllvm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gllvm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette1.html">Analysing multivariate abundance data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette2.html">Analysing high-dimensional microbial community data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette3.html">Introduction to gllvm Part 1: Ordination</a>
    </li>
    <li>
      <a href="../articles/vignette4.html">Introduction to gllvm Part 2: Species correlations</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JenniNiku/gllvm/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette4_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="vignette4_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="vignette4_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to gllvm Part 2: Species correlations</h1>
                        <h4 class="author">Jenni Niku</h4>
            
            <h4 class="date">2020-12-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JenniNiku/gllvm/blob/master/vignettes/vignette4.rmd"><code>vignettes/vignette4.rmd</code></a></small>
      <div class="hidden name"><code>vignette4.rmd</code></div>

    </div>

    
    
<div id="introduction-to-gllvm" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-to-gllvm" class="anchor"></a>Introduction to gllvm</h1>
<div id="r-package-gllvm" class="section level2">
<h2 class="hasAnchor">
<a href="#r-package-gllvm" class="anchor"></a>R package gllvm</h2>
<ul>
<li><p><strong>R</strong> package <strong>gllvm</strong> fits Generalized linear latent variable models (GLLVM) for multivariate data<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p></li>
<li><p>Developed by J. Niku, W.Brooks, R. Herliansyah, F.K.C. Hui, S. Taskinen, D.I. Warton, B. van der Veen.</p></li>
<li>
<p>Version 1.2.3 now available in</p>
<ul>
<li>GitHub: <a href="https://github.com/JenniNiku/gllvm" class="uri">https://github.com/JenniNiku/gllvm</a>
</li>
<li>CRAN: <a href="https://cran.r-project.org/web/packages/gllvm/index.html" class="uri">https://cran.r-project.org/web/packages/gllvm/index.html</a>
</li>
</ul>
</li>
<li><p>Package installation:</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># From CRAN</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">gllvm</span><span class="op">)</span>
<span class="co"># OR</span>
<span class="co"># From GitHub using devtools package's function install_github</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"JenniNiku/gllvm"</span><span class="op">)</span></code></pre></div>
<details><p><summary><span style="color:red"> Problems? </span></summary></p>
<p><span style="color:red"> <strong>gllvm</strong> package depends on R packages <strong>TMB</strong> and <strong>mvabund</strong>, try to install these first.</span></p>
</details><ul>
<li><p>GLLVMs are computationally intensive to fit due the integral in log-likelihood.</p></li>
<li><p>Often such models have been fitted using MCMC approach, which is very time consuming.</p></li>
<li><p><strong>gllvm</strong> package overcomes computational problems by applying closed form approximations to log-likelihood and using automatic differentiation in C++ to accelerate computation times (<strong>TMB</strong><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>).</p></li>
<li><p>Estimation is performed using either variational approximation (VA<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>) or Laplace approximation (LA<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>) method implemented via <strong>R</strong> package <strong>TMB</strong>.</p></li>
<li><p>VA method is faster and more accurate than LA, but not applicable for all distributions and link functions.</p></li>
<li>
<p>Using <strong>gllvm</strong> we can fit</p>
<ul>
<li>GLLVM without covariates gives model-based ordination and biplots</li>
<li>GLLVM with environmental and/or trait covariates for studying factors explaining species abundance</li>
<li>Fourth corner models with latent variables for studying environmental-trait interactions</li>
<li>GLLVM without latent variables fits basic multivariate GLMs</li>
</ul>
</li>
<li><p>Additional tools: residuals, information criterias, confidence intervals, visualization.</p></li>
</ul>
</div>
<div id="distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#distributions" class="anchor"></a>Distributions</h2>
<table class="table">
<thead><tr class="header">
<th>Response</th>
<th align="center">Distribution</th>
<th align="left">Method</th>
<th align="left">Link</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Counts</td>
<td align="center">Poisson</td>
<td align="left">VA/LA</td>
<td align="left">log</td>
</tr>
<tr class="even">
<td></td>
<td align="center">NB</td>
<td align="left">VA/LA</td>
<td align="left">log</td>
</tr>
<tr class="odd">
<td></td>
<td align="center">ZIP</td>
<td align="left">LA</td>
<td align="left">log</td>
</tr>
<tr class="even">
<td>Binary</td>
<td align="center">Bernoulli</td>
<td align="left">VA/LA</td>
<td align="left">probit</td>
</tr>
<tr class="odd">
<td></td>
<td align="center"></td>
<td align="left">LA</td>
<td align="left">logit</td>
</tr>
<tr class="even">
<td>Ordinal</td>
<td align="center">Ordinal</td>
<td align="left">VA</td>
<td align="left">probit</td>
</tr>
<tr class="odd">
<td>Normal</td>
<td align="center">Gaussian</td>
<td align="left">VA/LA</td>
<td align="left">identity</td>
</tr>
<tr class="even">
<td>Positive continuous</td>
<td align="center">Gamma</td>
<td align="left">VA/LA</td>
<td align="left">log</td>
</tr>
<tr class="odd">
<td>non-negative continuous</td>
<td align="center">Exponential</td>
<td align="left">VA/LA</td>
<td align="left">log</td>
</tr>
<tr class="even">
<td>Biomass</td>
<td align="center">Tweedie</td>
<td align="left">LA</td>
<td align="left">log</td>
</tr>
</tbody>
</table>
</div>
<div id="data-input" class="section level2">
<h2 class="hasAnchor">
<a href="#data-input" class="anchor"></a>Data input</h2>
<p>Main function of the <strong>gllvm</strong> package is <code><a href="../reference/gllvm.html">gllvm()</a></code>, which can be used to fit GLLVMs for multivariate data with the most important arguments listed in the following:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="cn">NULL</span>, X <span class="op">=</span> <span class="cn">NULL</span>, TR <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">family</span>, num.lv <span class="op">=</span> <span class="fl">2</span>, 
 formula <span class="op">=</span> <span class="cn">NULL</span>, method <span class="op">=</span> <span class="st">"VA"</span>, row.eff <span class="op">=</span> <span class="cn">FALSE</span>, n.init<span class="op">=</span><span class="fl">1</span>, starting.val <span class="op">=</span><span class="st">"res"</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
<ul>
<li>y: matrix of abundances</li>
<li>X: matrix or data.frame of environmental variables</li>
<li>TR: matrix or data.frame of trait variables</li>
<li>family: distribution for responses</li>
<li>num.lv: number of latent variables</li>
<li>method: approximation used “VA” or “LA”</li>
<li>row.eff: type of row effects</li>
<li>n.init: number of random starting points for latent variables</li>
<li>starting.val: starting value method</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JenniNiku/gllvm">gllvm</a></span><span class="op">)</span>
<span class="co">## Loading required package: TMB</span>
<span class="co">## Loading required package: mvabund</span>
<span class="co">## </span>
<span class="co">## Attaching package: 'gllvm'</span>
<span class="co">## The following object is masked from 'package:mvabund':</span>
<span class="co">## </span>
<span class="co">##     coefplot</span>
<span class="co">## The following objects are masked from 'package:stats':</span>
<span class="co">## </span>
<span class="co">##     predict, simulate</span></code></pre></div>
</div>
<div id="example-spiders" class="section level2">
<h2 class="hasAnchor">
<a href="#example-spiders" class="anchor"></a>Example: Spiders</h2>
<ul>
<li>Abundances of 12 hunting spider species measured as a count at 28 sites.</li>
<li>Six environmental variables measured at each site:
<ul>
<li>
<code>soil.dry</code>: Soil dry mass</li>
<li>
<code>bare.sand</code>: cover of bare sand</li>
<li>
<code>fallen.leaves</code>: cover of fallen leaves/twigs</li>
<li>
<code>moss</code>: cover of moss</li>
<li>
<code>herb.layer</code>: cover of herb layer</li>
<li>
<code>reflection</code>: reflection of the soil surface with a cloudless sky</li>
</ul>
</li>
</ul>
</div>
<div id="data-fitting" class="section level2">
<h2 class="hasAnchor">
<a href="#data-fitting" class="anchor"></a>Data fitting</h2>
<p>Fit GLLVM with environmental variables <span class="math inline">\(g(E(y_{ij})) = \beta_{0j} + \boldsymbol{x}_i'\boldsymbol{\beta}_{j} + \boldsymbol{u}_i'\boldsymbol{\theta}_j\)</span> using <strong>gllvm</strong>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JenniNiku/gllvm">gllvm</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"spider"</span><span class="op">)</span>
<span class="va">fitx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, X<span class="op">=</span><span class="va">spider</span><span class="op">$</span><span class="va">x</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span>
<span class="va">fitx</span>
<span class="co">## Call: </span>
<span class="co">## gllvm(y = spider$abund, X = spider$x, family = "negative.binomial")</span>
<span class="co">## family: </span>
<span class="co">## [1] "negative.binomial"</span>
<span class="co">## method: </span>
<span class="co">## [1] "VA"</span>
<span class="co">## </span>
<span class="co">## log-likelihood:  -593.6748 </span>
<span class="co">## Residual degrees of freedom:  217 </span>
<span class="co">## AIC:  1425.35 </span>
<span class="co">## AICc:  1114.915 </span>
<span class="co">## BIC:  1583.882</span></code></pre></div>
</div>
<div id="model-selection" class="section level2">
<h2 class="hasAnchor">
<a href="#model-selection" class="anchor"></a>Model selection</h2>
<ul>
<li>Number of latent variables is not necessarily clear beforehand when goal is not primarily in ordination, so information criterias can be used for model selection. For example, using Akaike information criterion:</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">X</span><span class="op">=</span><span class="va">spider</span><span class="op">$</span><span class="va">x</span>
<span class="va">fitx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, <span class="va">X</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">fitx2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, <span class="va">X</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">fitx3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, <span class="va">X</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">fitx1</span><span class="op">)</span>
<span class="co">## [1] 1393.837</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">fitx2</span><span class="op">)</span>
<span class="co">## [1] 1425.35</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">fitx3</span><span class="op">)</span>
<span class="co">## [1] 1445.35</span></code></pre></div>
</div>
<div id="residual-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#residual-analysis" class="anchor"></a>Residual analysis</h2>
<ul>
<li>Residual analysis can be used to assess the appropriateness of the fitted model (eg. in terms of mean-variance relationship). Can be performed using <code><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html">plot()</a></code>:</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html">plot</a></span><span class="op">(</span><span class="va">fitx1</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="vignette4_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="exercises" class="section level1">
<h1 class="hasAnchor">
<a href="#exercises" class="anchor"></a>Exercises</h1>
<p><span style="color:blue"> E1. Load spider data from <strong>mvabund</strong> package and take a look at the dataset. </span></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JenniNiku/gllvm">gllvm</a></span><span class="op">)</span>
<span class="co">#Package **mvabund** is loaded with **gllvm** so just load with a function `data()`.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"spider"</span><span class="op">)</span>
<span class="co"># more info: </span>
<span class="co"># ?spider</span></code></pre></div>
<details><p><summary><span style="color:red"> show me the answers. </span></summary></p>
<p><span style="color:red"> Package <strong>mvabund</strong> is loaded with <strong>gllvm</strong> so just load with a function <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code>. </span></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># response matrix:</span>
<span class="va">spider</span><span class="op">$</span><span class="va">abund</span>
<span class="co">##    Alopacce Alopcune Alopfabr Arctlute Arctperi Auloalbi Pardlugu Pardmont</span>
<span class="co">## 1        25       10        0        0        0        4        0       60</span>
<span class="co">## 2         0        2        0        0        0       30        1        1</span>
<span class="co">## 3        15       20        2        2        0        9        1       29</span>
<span class="co">## 4         2        6        0        1        0       24        1        7</span>
<span class="co">## 5         1       20        0        2        0        9        1        2</span>
<span class="co">## 6         0        6        0        6        0        6        0       11</span>
<span class="co">## 7         2        7        0       12        0       16        1       30</span>
<span class="co">## 8         0       11        0        0        0        7       55        2</span>
<span class="co">## 9         1        1        0        0        0        0        0       26</span>
<span class="co">## 10        3        0        1        0        0        0        0       22</span>
<span class="co">## 11       15        1        2        0        0        1        0       95</span>
<span class="co">## 12       16       13        0        0        0        0        0       96</span>
<span class="co">## 13        3       43        1        2        0       18        1       24</span>
<span class="co">## 14        0        2        0        1        0        4        3       14</span>
<span class="co">## 15        0        0        0        0        0        0        6        0</span>
<span class="co">## 16        0        3        0        0        0        0        6        0</span>
<span class="co">## 17        0        0        0        0        0        0        2        0</span>
<span class="co">## 18        0        1        0        0        0        0        5        0</span>
<span class="co">## 19        0        1        0        0        0        0       12        0</span>
<span class="co">## 20        0        2        0        0        0        0       13        0</span>
<span class="co">## 21        0        1        0        0        0        0       16        1</span>
<span class="co">## 22        7        0       16        0        4        0        0        2</span>
<span class="co">## 23       17        0       15        0        7        0        2        6</span>
<span class="co">## 24       11        0       20        0        5        0        0        3</span>
<span class="co">## 25        9        1        9        0        0        2        1       11</span>
<span class="co">## 26        3        0        6        0       18        0        0        0</span>
<span class="co">## 27       29        0       11        0        4        0        0        1</span>
<span class="co">## 28       15        0       14        0        1        0        0        6</span>
<span class="co">##    Pardnigr Pardpull Trocterr Zoraspin</span>
<span class="co">## 1        12       45       57        4</span>
<span class="co">## 2        15       37       65        9</span>
<span class="co">## 3        18       45       66        1</span>
<span class="co">## 4        29       94       86       25</span>
<span class="co">## 5       135       76       91       17</span>
<span class="co">## 6        27       24       63       34</span>
<span class="co">## 7        89      105      118       16</span>
<span class="co">## 8         2        1       30        3</span>
<span class="co">## 9         1        1        2        0</span>
<span class="co">## 10        0        0        1        0</span>
<span class="co">## 11        0        1        4        0</span>
<span class="co">## 12        1        8       13        0</span>
<span class="co">## 13       53       72       97       22</span>
<span class="co">## 14       15       72       94       32</span>
<span class="co">## 15        0        0       25        3</span>
<span class="co">## 16        2        0       28        4</span>
<span class="co">## 17        0        0       23        2</span>
<span class="co">## 18        0        0       25        0</span>
<span class="co">## 19        1        0       22        3</span>
<span class="co">## 20        0        0       22        2</span>
<span class="co">## 21        0        1       18        2</span>
<span class="co">## 22        0        0        1        0</span>
<span class="co">## 23        0        0        1        0</span>
<span class="co">## 24        0        0        0        0</span>
<span class="co">## 25        6        0       16        6</span>
<span class="co">## 26        0        0        1        0</span>
<span class="co">## 27        0        0        0        0</span>
<span class="co">## 28        0        0        2        0</span>
<span class="co"># Environmental variables</span>
<span class="va">spider</span><span class="op">$</span><span class="va">x</span>
<span class="co">##       soil.dry bare.sand fallen.leaves   moss herb.layer reflection</span>
<span class="co">##  [1,]   2.3321    0.0000        0.0000 3.0445     4.4543     3.9120</span>
<span class="co">##  [2,]   3.0493    0.0000        1.7918 1.0986     4.5643     1.6094</span>
<span class="co">##  [3,]   2.5572    0.0000        0.0000 2.3979     4.6052     3.6889</span>
<span class="co">##  [4,]   2.6741    0.0000        0.0000 2.3979     4.6151     2.9957</span>
<span class="co">##  [5,]   3.0155    0.0000        0.0000 0.0000     4.6151     2.3026</span>
<span class="co">##  [6,]   3.3810    2.3979        3.4340 2.3979     3.4340     0.6931</span>
<span class="co">##  [7,]   3.1781    0.0000        0.0000 0.6931     4.6151     2.3026</span>
<span class="co">##  [8,]   2.6247    0.0000        4.2627 1.0986     3.4340     0.6931</span>
<span class="co">##  [9,]   2.4849    0.0000        0.0000 4.3307     3.2581     3.4012</span>
<span class="co">## [10,]   2.1972    3.9318        0.0000 3.4340     3.0445     3.6889</span>
<span class="co">## [11,]   2.2192    0.0000        0.0000 4.1109     3.7136     3.6889</span>
<span class="co">## [12,]   2.2925    0.0000        0.0000 3.8286     4.0254     3.6889</span>
<span class="co">## [13,]   3.5175    1.7918        1.7918 0.6931     4.5109     3.4012</span>
<span class="co">## [14,]   3.0865    0.0000        0.0000 1.7918     4.5643     1.0986</span>
<span class="co">## [15,]   3.2696    0.0000        4.3944 0.6931     3.0445     0.6931</span>
<span class="co">## [16,]   3.0301    0.0000        4.6052 0.6931     0.6931     0.0000</span>
<span class="co">## [17,]   3.3322    0.0000        4.4543 0.6931     3.0445     1.0986</span>
<span class="co">## [18,]   3.1224    0.0000        4.3944 0.0000     3.0445     1.0986</span>
<span class="co">## [19,]   2.9232    0.0000        4.5109 1.6094     1.6094     0.0000</span>
<span class="co">## [20,]   3.1091    0.0000        4.5951 0.6931     0.6931     0.0000</span>
<span class="co">## [21,]   2.9755    0.0000        4.5643 0.6931     1.7918     0.0000</span>
<span class="co">## [22,]   1.2528    3.2581        0.0000 4.3307     0.6931     3.9120</span>
<span class="co">## [23,]   1.1939    3.0445        0.0000 4.0254     3.2581     4.0943</span>
<span class="co">## [24,]   1.6487    3.2581        0.0000 4.0254     3.0445     4.0073</span>
<span class="co">## [25,]   1.8245    3.5835        0.0000 1.0986     4.1109     2.3026</span>
<span class="co">## [26,]   0.9933    4.5109        0.0000 1.7918     1.7918     4.3820</span>
<span class="co">## [27,]   0.9555    2.3979        0.0000 3.8286     3.4340     3.6889</span>
<span class="co">## [28,]   0.9555    3.4340        0.0000 3.7136     3.4340     3.6889</span>
<span class="co"># Plot data using boxplot:</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span><span class="op">)</span></code></pre></div>
<p><img src="vignette4_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;"></p>
</details><p><span style="color:blue"> E2. Fit GLLVM with two latent variables to spider data with a suitable distribution. Data consists of counts of spider species.</span></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Take a look at the function documentation for help: </span>
<span class="op">?</span><span class="va">gllvm</span></code></pre></div>
<details><p><summary><span style="color:red"> Show me the answers. </span></summary></p>
<p><span style="color:red"> 2. Response variables in spider data are counts, so Poisson, negative binomial and zero inflated Poisson are possible. However, ZIP is implemented only with Laplace method, so it need to be noticed, that if models are fitted with different methods they can not be compared with information criterias. Let’s try just with a Poisson and NB.</span> <span style="color:red"> <strong>NOTE THAT</strong> the results may not be exactly the same as below, as the initial values for each model fit are slightly different, so the results may</span></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fit a GLLVM to data</span>
<span class="va">fitp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">fitp</span>
<span class="co">## Call: </span>
<span class="co">## gllvm(y = spider$abund, family = poisson())</span>
<span class="co">## family: </span>
<span class="co">## [1] "poisson"</span>
<span class="co">## method: </span>
<span class="co">## [1] "VA"</span>
<span class="co">## </span>
<span class="co">## log-likelihood:  -845.8277 </span>
<span class="co">## Residual degrees of freedom:  301 </span>
<span class="co">## AIC:  1761.655 </span>
<span class="co">## AICc:  1446.655 </span>
<span class="co">## BIC:  1808.283</span>
<span class="va">fitnb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span>
<span class="va">fitnb</span>
<span class="co">## Call: </span>
<span class="co">## gllvm(y = spider$abund, family = "negative.binomial")</span>
<span class="co">## family: </span>
<span class="co">## [1] "negative.binomial"</span>
<span class="co">## method: </span>
<span class="co">## [1] "VA"</span>
<span class="co">## </span>
<span class="co">## log-likelihood:  -733.6806 </span>
<span class="co">## Residual degrees of freedom:  289 </span>
<span class="co">## AIC:  1561.361 </span>
<span class="co">## AICc:  1335.761 </span>
<span class="co">## BIC:  1623.975</span></code></pre></div>
<p>Based on AIC, NB distribution suits better. How about residual analysis: <span style="color:red"> <strong>NOTE THAT</strong> The package uses randomized quantile residuals so each time you plot the residuals, they look a little different.</span></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fit a GLLVM to data</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html">plot</a></span><span class="op">(</span><span class="va">fitp</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="vignette4_files/figure-html/unnamed-chunk-11-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/mvabund/man/mvabund-internal.html">plot</a></span><span class="op">(</span><span class="va">fitnb</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="vignette4_files/figure-html/unnamed-chunk-11-2.png" width="768" style="display: block; margin: auto;"></p>
<p>You could do these comparisons with Laplace method as well, using the code below, and it would give the same conclusion that NB distribution suits best:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fitLAp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"LA"</span><span class="op">)</span>
<span class="va">fitLAnb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, method <span class="op">=</span> <span class="st">"LA"</span><span class="op">)</span>
<span class="va">fitLAzip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, family <span class="op">=</span> <span class="st">"ZIP"</span>, method <span class="op">=</span> <span class="st">"LA"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">fitLAp</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">fitLAnb</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">fitLAzip</span><span class="op">)</span></code></pre></div>
GLLVM with two latent variables can be used as a model-based approach to unconstrained ordination, as considered at the first day of the workshop.
</details><p><span style="color:blue"> E3. Fit GLLVM with environmental variables <code>soil.dry</code> and <code>reflection</code> to the data with suitable number of latent variables. </span></p>
<details><p><summary><span style="color:red"> Show me the answers. </span></summary></p>
<p><span style="color:red"> We can extract the two columns from the environmental variable matrix or define the model using formula. </span></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># `soil.dry` and `reflection` are in columns 1 and 6</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="va">spider</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span>
<span class="va">fitx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, <span class="va">X</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">fitx2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, <span class="va">X</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">fitx3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, <span class="va">X</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">fitx1</span><span class="op">)</span>
<span class="co">## [1] 1449.428</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">fitx2</span><span class="op">)</span>
<span class="co">## [1] 1471.326</span>
<span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">fitx3</span><span class="op">)</span>
<span class="co">## [1] 1491.326</span>
<span class="co"># Or alternatively using formula:</span>
<span class="va">fitx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, <span class="va">spider</span><span class="op">$</span><span class="va">x</span>, formula <span class="op">=</span> <span class="op">~</span><span class="va">soil.dry</span> <span class="op">+</span> <span class="va">reflection</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">fitx1</span>
<span class="co">## Call: </span>
<span class="co">## gllvm(y = spider$abund, X = spider$x, formula = ~soil.dry + reflection, </span>
<span class="co">##     num.lv = 1, family = "negative.binomial")</span>
<span class="co">## family: </span>
<span class="co">## [1] "negative.binomial"</span>
<span class="co">## method: </span>
<span class="co">## [1] "VA"</span>
<span class="co">## </span>
<span class="co">## log-likelihood:  -664.7138 </span>
<span class="co">## Residual degrees of freedom:  276 </span>
<span class="co">## AIC:  1449.428 </span>
<span class="co">## AICc:  1227.61 </span>
<span class="co">## BIC:  1529.36</span></code></pre></div>
Model with one latent variable gave the lowest AIC value.
</details><p><span style="color:blue"> E4. Explore the model fit. Find the coefficients for environmental covariates. </span></p>
<details><p><summary><span style="color:red"> Show me the answers. </span></summary></p>
<p><span style="color:red"> Estimated parameters can be obtained with <code><a href="https://rdrr.io/r/stats/coef.html">coef()</a></code> function. Confidence intervals for parameters are obtained with <code><a href="https://rdrr.io/r/stats/confint.html">confint()</a></code>. </span></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fitx1</span><span class="op">)</span>
<span class="co">## $theta</span>
<span class="co">##                [,1]</span>
<span class="co">##  [1,]  8.536290e-01</span>
<span class="co">##  [2,]  1.098448e+00</span>
<span class="co">##  [3,]  3.765570e-01</span>
<span class="co">##  [4,]  1.930596e+00</span>
<span class="co">##  [5,] -4.422066e-08</span>
<span class="co">##  [6,]  2.133381e+00</span>
<span class="co">##  [7,]  3.392654e-01</span>
<span class="co">##  [8,]  8.160417e-01</span>
<span class="co">##  [9,]  2.190719e+00</span>
<span class="co">## [10,]  2.158313e+00</span>
<span class="co">## [11,]  8.245553e-01</span>
<span class="co">## [12,]  1.495124e+00</span>
<span class="co">## </span>
<span class="co">## $Intercept</span>
<span class="co">##   Alopacce   Alopcune   Alopfabr   Arctlute   Arctperi   Auloalbi   Pardlugu </span>
<span class="co">##  -3.009408  -7.407512   2.077837 -21.475543  -7.919926 -12.966457   4.567650 </span>
<span class="co">##   Pardmont   Pardnigr   Pardpull   Trocterr   Zoraspin </span>
<span class="co">##  -6.091034 -14.644199 -16.455574  -3.711618  -9.215344 </span>
<span class="co">## </span>
<span class="co">## $Xcoef</span>
<span class="co">##            soil.dry reflection</span>
<span class="co">## Alopacce -0.3441245  1.5943477</span>
<span class="co">## Alopcune  2.6112227  0.6247303</span>
<span class="co">## Alopfabr -1.8669349  0.7468443</span>
<span class="co">## Arctlute  6.3215563  0.8206891</span>
<span class="co">## Arctperi -1.7566483  2.8891766</span>
<span class="co">## Auloalbi  4.1813035  0.6832562</span>
<span class="co">## Pardlugu -0.5452650 -1.2604825</span>
<span class="co">## Pardmont  1.7924348  1.4691739</span>
<span class="co">## Pardnigr  4.9041013  0.8602552</span>
<span class="co">## Pardpull  5.3495987  1.2823866</span>
<span class="co">## Trocterr  2.3357619  0.2234865</span>
<span class="co">## Zoraspin  3.5555021  0.1198880</span>
<span class="co">## </span>
<span class="co">## $inv.phi</span>
<span class="co">##     Alopacce     Alopcune     Alopfabr     Arctlute     Arctperi     Auloalbi </span>
<span class="co">## 9.380050e+00 1.699453e+00 1.577650e+00 1.064243e+00 7.144125e+06 1.511550e+00 </span>
<span class="co">##     Pardlugu     Pardmont     Pardnigr     Pardpull     Trocterr     Zoraspin </span>
<span class="co">## 1.543684e+00 9.784678e-01 2.517889e+00 2.339489e+00 1.470924e+01 3.625108e+00 </span>
<span class="co">## </span>
<span class="co">## $phi</span>
<span class="co">##     Alopacce     Alopcune     Alopfabr     Arctlute     Arctperi     Auloalbi </span>
<span class="co">## 1.066092e-01 5.884245e-01 6.338543e-01 9.396354e-01 1.399752e-07 6.615724e-01 </span>
<span class="co">##     Pardlugu     Pardmont     Pardnigr     Pardpull     Trocterr     Zoraspin </span>
<span class="co">## 6.478009e-01 1.022006e+00 3.971581e-01 4.274437e-01 6.798450e-02 2.758538e-01</span>
<span class="co"># Coefficients for covariates are named as `Xcoef`</span>
<span class="co"># Confidence intervals for these coefficients:</span>
<span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">fitx1</span>, parm <span class="op">=</span> <span class="st">"Xcoef"</span><span class="op">)</span>
<span class="co">##                cilow       ciup</span>
<span class="co">## Xcoef1  -0.894098580  0.2058496</span>
<span class="co">## Xcoef2   1.606647597  3.6157978</span>
<span class="co">## Xcoef3  -2.834988807 -0.8988810</span>
<span class="co">## Xcoef4   5.728753598  6.9143589</span>
<span class="co">## Xcoef5  -2.876030960 -0.6372656</span>
<span class="co">## Xcoef6   2.777610509  5.5849965</span>
<span class="co">## Xcoef7  -1.626608957  0.5360790</span>
<span class="co">## Xcoef8   0.825433707  2.7594359</span>
<span class="co">## Xcoef9   3.717894750  6.0903078</span>
<span class="co">## Xcoef10  4.084501231  6.6146962</span>
<span class="co">## Xcoef11  1.892697456  2.7788263</span>
<span class="co">## Xcoef12  2.472022569  4.6389816</span>
<span class="co">## Xcoef13  0.992990554  2.1957049</span>
<span class="co">## Xcoef14  0.229845161  1.0196154</span>
<span class="co">## Xcoef15 -0.234126921  1.7278155</span>
<span class="co">## Xcoef16 -0.031195847  1.6725740</span>
<span class="co">## Xcoef17  1.638108794  4.1402445</span>
<span class="co">## Xcoef18  0.041533290  1.3249791</span>
<span class="co">## Xcoef19 -1.726539684 -0.7944253</span>
<span class="co">## Xcoef20  0.930600324  2.0077475</span>
<span class="co">## Xcoef21  0.242662514  1.4778479</span>
<span class="co">## Xcoef22  0.648046626  1.9167266</span>
<span class="co">## Xcoef23 -0.005489724  0.4524628</span>
<span class="co">## Xcoef24 -0.324187704  0.5639637</span>
<span class="co"># The first 12 intervals are for soil.dry and next 12 for reflection</span></code></pre></div>
</details><details><p><summary><span style="color:red"> Problems? See hints:</span></summary></p>
<p><span style="color:red"> I have problems in model fitting. My model converges to infinity or local maxima: </span> GLLVMs are complex models where starting values have a big role. Choosing a different starting value method (see argument <code>starting.val</code>) or use multiple runs and pick up the one giving highest log-likelihood value using argument <code>n.init</code>. More variation to the starting points can be added with <code>jitter.var</code>.</p>
<p><span style="color:red"> My results does not look the same as in answers:</span> The results may not be exactly the same as in the answers, as the initial values for each model fit are slightly different, so the results may also differ slightly.</p>
</details>
</div>
<div id="studying-species-correlations" class="section level1">
<h1 class="hasAnchor">
<a href="#studying-species-correlations" class="anchor"></a>Studying species correlations</h1>
<div id="species-correlations" class="section level2">
<h2 class="hasAnchor">
<a href="#species-correlations" class="anchor"></a>Species correlations</h2>
<ul>
<li><p>Latent variables induce correlation across response variables, and so provide means of estimating correlation patterns across species, and the extent to which they can be explained by environmental variables.</p></li>
<li><p>Information on correlation is stored in the LV loadings <span class="math inline">\(\boldsymbol\theta_j\)</span>, so the residual covariance matrix, storing information on species co-occurrence that is not explained by environmental variables, can be calculated as <span class="math inline">\(\boldsymbol\Sigma=\boldsymbol\Gamma \boldsymbol\Gamma^\top\)</span>, where <span class="math inline">\(\boldsymbol\Gamma = [\boldsymbol\theta_1\dots\boldsymbol\theta_m]'\)</span>.</p></li>
<li><p><code>getResidualCor</code> function can be used to estimate the correlation matrix of the linear predictor across species.</p></li>
<li><p>Let’s consider first the correlation matrix based on a model without predictors: <span class="math inline">\(g(E(y_{ij})) = \beta_{0j} + \boldsymbol{u}_i'\boldsymbol{\theta}_j\)</span></p></li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fitnb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span></code></pre></div>
<ul>
<li>The correlation matrix based on such model does not take into account the environmental conditions driving species abundances at sites, and reflects only what has been observed.</li>
</ul>
</div>
<div id="visualizing-species-correlations" class="section level2">
<h2 class="hasAnchor">
<a href="#visualizing-species-correlations" class="anchor"></a>Visualizing species correlations</h2>
<ul>
<li><p>The residual correlations can be visualized either using biplot, which shows the species ordination, or visualizing the actual correlation matrix using, eg., a <code>corrplot</code> package.</p></li>
<li><p>The biplot can be produced using a function <code><a href="../reference/ordiplot.gllvm.html">ordiplot()</a></code> with an argument <code>biplot = TRUE</code>:</p></li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fitnb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span>
<span class="fu"><a href="../reference/ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fitnb</span>, biplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, v <span class="op">=</span> <span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="vignette4_files/figure-html/unnamed-chunk-17-1.png" width="432" style="display: block; margin: auto;"></p>
<ul>
<li>Correlations can be visualized more precisely using <code><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot()</a></code> function:</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fitnb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span><span class="op">)</span>
<span class="va">cr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getResidualCor.gllvm.html">getResidualCor</a></span><span class="op">(</span><span class="va">fitnb</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot">corrplot</a></span><span class="op">)</span>;
<span class="co">## corrplot 0.84 loaded</span>
<span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span><span class="op">(</span><span class="va">cr</span>, diag <span class="op">=</span> <span class="cn">FALSE</span>, type <span class="op">=</span> <span class="st">"lower"</span>, method <span class="op">=</span> <span class="st">"square"</span>, tl.srt <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></code></pre></div>
<p><img src="vignette4_files/figure-html/unnamed-chunk-18-1.png" width="480" style="display: block; margin: auto;"></p>
<ul>
<li>The same correlations can also be visualized with species ordination in biplot:</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fitnb</span>, biplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, v <span class="op">=</span> <span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="studying-effects-of-covariates" class="section level1">
<h1 class="hasAnchor">
<a href="#studying-effects-of-covariates" class="anchor"></a>Studying effects of covariates</h1>
<div id="studying-effects-of-environmental-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#studying-effects-of-environmental-variables" class="anchor"></a>Studying effects of environmental variables</h2>
<ul>
<li>The effects of environmental variables on species can be studied by including environmental variables <span class="math inline">\(\boldsymbol{x}_i\)</span> to GLLVM: <span class="math inline">\(g(E(y_{ij})) = \beta_{0j} + \boldsymbol{x}_i'\boldsymbol{\beta}_{j} + \boldsymbol{u}_i'\boldsymbol{\theta}_j\)</span>.</li>
<li>
<span class="math inline">\(\boldsymbol{\beta}_{j}\)</span> is a vector of species specific coefficients for environmental variables.</li>
<li>Next consider for example two environmental variables, <code>soil.dry</code> (soil dry mass) and <code>reflection</code> (reflection of the soil surface with a cloudless sky), which shows different environmental gradients in ordination:</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rbPal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#00FA9A"</span>, <span class="st">"#00EC9F"</span>, <span class="st">"#00DFA4"</span>, <span class="st">"#00D2A9"</span>, <span class="st">"#00C5AF"</span>, <span class="st">"#00B8B4"</span>, <span class="st">"#00ABB9"</span>, <span class="st">"#009DBF"</span>, <span class="st">"#0090C4"</span>, <span class="st">"#0083C9"</span>, <span class="st">"#0076CF"</span>, <span class="st">"#0069D4"</span>, <span class="st">"#005CD9"</span>, <span class="st">"#004EDF"</span>, <span class="st">"#0041E4"</span>, <span class="st">"#0034E9"</span>, <span class="st">"#0027EF"</span>, <span class="st">"#001AF4"</span>, <span class="st">"#000DF9"</span>, <span class="st">"#0000FF"</span><span class="op">)</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="va">spider</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
<span class="va">Col</span> <span class="op">&lt;-</span> <span class="va">rbPal</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="../reference/ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">fitnb</span>, symbols <span class="op">=</span> <span class="cn">T</span>, s.colors <span class="op">=</span> <span class="va">Col</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, biplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fl">0</span>,v<span class="op">=</span><span class="fl">0</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span>

<span class="op">}</span></code></pre></div>
<p><img src="vignette4_files/figure-html/unnamed-chunk-20-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="coefficient-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#coefficient-plot" class="anchor"></a>Coefficient plot</h2>
<ul>
<li>
<code><a href="../reference/coefplot.gllvm.html">coefplot()</a></code> plots point estimates of the species specific environmental coefficients <span class="math inline">\(\boldsymbol{\beta}_{j}\)</span> with confidence intervals.</li>
<li>As biplots with environmental gradients indicated that, for example, species named Arctperi prefers sites with low amount of dry soil mass and high amount of reflection with sky, the similar effects can be seen in the coefficients plotted with their confidence intervals.</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fitx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">spider</span><span class="op">$</span><span class="va">abund</span>, <span class="va">X</span>, family <span class="op">=</span> <span class="st">"negative.binomial"</span>, num.lv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="../reference/coefplot.gllvm.html">coefplot</a></span><span class="op">(</span><span class="va">fitx1</span>, mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, cex.ylab <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></code></pre></div>
<p><img src="vignette4_files/figure-html/unnamed-chunk-21-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="correlation-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#correlation-matrix" class="anchor"></a>Correlation matrix</h2>
<ul>
<li>Correlation matrix for model with predictors shows correlation patterns between species when the effect of the predictors are taken into account.</li>
<li>When the effects of covariates <code>dry.soil</code> and <code>reflection</code> were accounted, negative correlation between species do not seem to exist anymore, indicating that negative correlations were explained by different environmental conditions at sites and how species respond to them, rather than direct species interactions.</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getResidualCor.gllvm.html">getResidualCor</a></span><span class="op">(</span><span class="va">fitx1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span><span class="op">(</span><span class="va">crx</span>, diag <span class="op">=</span> <span class="cn">FALSE</span>, type <span class="op">=</span> <span class="st">"lower"</span>, method <span class="op">=</span> <span class="st">"square"</span>, tl.srt <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></code></pre></div>
<p><img src="vignette4_files/figure-html/unnamed-chunk-22-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="fourth-corner-models" class="section level2">
<h2 class="hasAnchor">
<a href="#fourth-corner-models" class="anchor"></a>Fourth corner models</h2>
<ul>
<li><p>If species trait variables <span class="math inline">\(\boldsymbol{t}_j\)</span>, measuring eg. species behaviour or physical appearance, would be available, fourth corner models should be considered: <span class="math inline">\(g(E(y_{ij})) = \beta_{0j} + \boldsymbol{x}_i'\boldsymbol{\beta}_{j} + \boldsymbol{x}_i'\boldsymbol{B}_{I}\boldsymbol{t}_j + \boldsymbol{u}_i'\boldsymbol{\theta}_j\)</span></p></li>
<li><p>Such models can also be fitted with <code><a href="../reference/gllvm.html">gllvm()</a></code> function by including a matrix of traits with argument <code>TR</code>.</p></li>
<li><p>Examples can be found in the <strong>gllvm</strong> package’s vignettes.</p></li>
</ul>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Niku, J., F.K.C. Hui, S. Taskinen, and D.I. Warton. 2019. Gllvm - Fast Analysis of Multivariate Abundance Data with Generalized Linear Latent Variable Models in R. 10. Methods in Ecology and Evolution: 2173–82<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Kasper Kristensen, Anders Nielsen, Casper W. Berg, Hans Skaug, Bradley M. Bell (2016). TMB: Automatic Differentiation and Laplace Approximation. Journal of Statistical Software, 70(5), 1-21<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Hui, F. K. C., Warton, D., Ormerod, J., Haapaniemi, V., and Taskinen, S. (2017). Variational approximations for generalized linear latent variable models. Journal of Computational and Graphical Statistics. Journal of Computational and Graphical Statistics, 26:35-43<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Niku, J., Warton, D. I., Hui, F. K. C., and Taskinen, S. (2017). Generalized linear latent variable models for multivariate count and biomass data in ecology. Journal of Agricultural, Biological, and Environmental Statistics, 22:498-522.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jenni Niku.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
