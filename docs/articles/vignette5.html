<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to use the quadratic response model • gllvm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to use the quadratic response model">
<meta property="og:description" content="gllvm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gllvm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette1.html">Analysing multivariate abundance data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette2.html">Analysing high-dimensional microbial community data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette3.html">Introduction to gllvm Part 1: Ordination</a>
    </li>
    <li>
      <a href="../articles/vignette4.html">Introduction to gllvm Part 2: Species correlations</a>
    </li>
    <li>
      <a href="../articles/vignette5.html">How to use the quadratic response model</a>
    </li>
    <li>
      <a href="../articles/vignette6.html">Model-based constrained ordination with latent variables</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JenniNiku/gllvm/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette5_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="vignette5_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="vignette5_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to use the quadratic response model</h1>
                        <h4 class="author">Bert van der Veen</h4>
            
            <h4 class="date">2021-07-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JenniNiku/gllvm/blob/master/vignettes/vignette5.Rmd"><code>vignettes/vignette5.Rmd</code></a></small>
      <div class="hidden name"><code>vignette5.Rmd</code></div>

    </div>

    
    
<p>In this example we demonstrate how to implement the quadratic response model in . Quadratic curves are frequently occurring in community ecology, specifically to describe the response of species to the environment. When one has measured predictor variables, a quadratic function can straightforwardly be included in a regression in R using the <span class="math inline">\(poly(\cdot,2)\)</span> function. However, in a GLLVM, latent variables are included that can represent unmeasured predictors. As such, we might want to test if species respond to those unknown predictors too. This is similar to the theory behind other ordination methods, such as Correspondence Analysis and its constrained variant (CCA).</p>
<p>We will use the hunting spider dataset as an example, which includes 12 species at 100 sites. It also includes measurements of the environment at 28 sites, though we will not use those here.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JenniNiku/gllvm">gllvm</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required package: TMB</code></pre>
<pre><code>## Loading required package: mvabund</code></pre>
<pre><code>## 
## Attaching package: 'gllvm'</code></pre>
<pre><code>## The following object is masked from 'package:mvabund':
## 
##     coefplot</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     nobs, predict, simulate, vcov</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"spider"</span><span class="op">)</span>
<span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">spider</span><span class="op">$</span><span class="va">abund</span></code></pre></div>
<p>The unique thing about the quadratic response model, is that specifying a quadratic term for each species separately, coincides with the assumption that species have their own ecological tolerances. A more simple more, would be to assume that species have the same tolerance, in essence that all species are a generalist or specialist to the same degree. This can be done using a linear response model, with random row-effects:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ftEqTol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">Y</span>, family <span class="op">=</span> <span class="st">"poisson"</span>, row.eff <span class="op">=</span> <span class="st">"random"</span>, num.lv <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Next, we can fit a model where we assume species tolerances are the same for all species, but unique per latent variable, which we will refer to as species common tolerances. We do this using the <code>quadratic</code> flag in the <span class="math inline">\(\text{gllvm}(.)\)</span> function, which has the options <code>FALSE</code>, <code>LV</code> (common tolerances), and <code>TRUE</code> (unique tolerances for all species).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ftComTol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">Y</span>, family <span class="op">=</span> <span class="st">"poisson"</span>, num.lv <span class="op">=</span> <span class="fl">2</span>, quadratic <span class="op">=</span> <span class="st">"LV"</span><span class="op">)</span></code></pre></div>
<p>And lastly, we can fit the full quadratic model.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ftUneqTol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">Y</span>, family <span class="op">=</span> <span class="st">"poisson"</span>, num.lv <span class="op">=</span> <span class="fl">2</span>, quadratic <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>GLLVMs are sensitive to the starting values, and with a quadratic response model even more so. As such, the unequal tolerances model by defaults fits a common tolerances model first, to use as starting values. This option is control through the <code>start.struc</code> argument in <code>start.control</code>.</p>
<p>Now, we can use information criteria to determine which of the models fits the hunting spider data best.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">ftEqTol</span>,<span class="va">ftComTol</span>,<span class="va">ftUneqTol</span><span class="op">)</span></code></pre></div>
<pre><code>##           df      AIC
## ftEqTol   36 1691.933
## ftComTol  37 1682.679
## ftUneqTol 59 1463.544</code></pre>
<p>The unequal tolerances model fits best, as measured by AICc. Species optima and tolerances, and their approximate standard errors, can be extracted:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Species optima for LVs</span>
<span class="fu"><a href="../reference/ecoCoefs.html">optima</a></span><span class="op">(</span><span class="va">ftUneqTol</span><span class="op">)</span></code></pre></div>
<pre><code>## $optima
##                    LV1        LV2
## Alopacce  3.965490e+00  0.0000000
## Alopcune -5.553114e+00  2.1737870
## Alopfabr  2.882229e+00 -5.0004136
## Arctlute -1.064758e-01  4.3714550
## Arctperi  4.941439e-01 -6.4059967
## Auloalbi -2.338145e+01  3.1944201
## Pardlugu -1.510996e+10  0.1721661
## Pardmont  6.694648e+00  6.3037105
## Pardnigr -2.275915e+00  2.6144288
## Pardpull -2.559914e+00  3.3701747
## Trocterr -2.421346e+00  2.9504054
## Zoraspin -1.973960e+00  4.6332028
## 
## $sd
##                   LV1       LV2
## Alopacce 1.552147e+00 0.0000000
## Alopcune 8.504350e+00 0.2524185
## Alopfabr 1.302789e+00 1.1896022
## Arctlute 7.333963e-01 0.4742044
## Arctperi 1.160039e+00 6.6971261
## Auloalbi 3.564340e+01 0.2703544
## Pardlugu 1.595992e+19 0.4218318
## Pardmont 2.407049e+00 0.5271869
## Pardnigr 6.314054e-01 0.2548808
## Pardpull 9.760564e-01 0.3184141
## Trocterr 2.337130e+00 0.2943099
## Zoraspin 4.502092e-01 0.5597117</code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Species tolerances</span>
<span class="fu"><a href="../reference/ecoCoefs.html">tolerances</a></span><span class="op">(</span><span class="va">ftUneqTol</span><span class="op">)</span></code></pre></div>
<pre><code>## $tolerances
##                   LV1          LV2
## Alopacce 1.991354e+00 75766.331108
## Alopcune 8.945236e+00     1.474377
## Alopfabr 1.953173e+00     3.781882
## Arctlute 1.202133e+00     1.563114
## Arctperi 2.258854e+00     1.534928
## Auloalbi 8.548964e+00     1.421615
## Pardlugu 1.795206e+05     2.500156
## Pardmont 4.077629e+00     4.277142
## Pardnigr 2.416366e+00     1.407778
## Pardpull 3.464405e+00     1.353039
## Trocterr 3.927594e+00     2.601884
## Zoraspin 2.419449e+00     3.130584
## 
## $sd
##                   LV1          LV2
## Alopacce 5.511496e-01 2.022875e+12
## Alopcune 8.441931e+00 1.210592e-01
## Alopfabr 6.742254e-01 8.571050e-01
## Arctlute 4.400838e-01 6.274575e-01
## Arctperi 1.302227e+00 6.200647e-01
## Auloalbi 9.199530e+00 1.190251e-01
## Pardlugu 1.340808e+14 5.221469e-01
## Pardmont 1.478596e+00 4.625374e-01
## Pardnigr 8.168787e-01 1.428389e-01
## Pardpull 1.202451e+00 1.100905e-01
## Trocterr 1.311188e+00 2.558470e-01
## Zoraspin 8.340288e-01 4.255038e-01</code></pre>
<p>The standard deviation of the latent variables can be printed using the <span class="math inline">\(summary(.)\)</span> function. Since latent variable models are scale invariant, this scale parameter is relative to the identifiability constraint (diagonal of the species scores matrix). It can be understood as a measure of gradient length, though for a measure that might be more comparable to DCA (i.e. on average unit variance species curves), see the reference below.</p>
<p>The residual variation explained can be used to calculate residual correlations, or to partition variation, similar as in the vanilla GLLVM:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Residual variance per latent variable</span>
<span class="co">#for the linear term</span>
<span class="fu"><a href="../reference/getResidualCov.gllvm.html">getResidualCov</a></span><span class="op">(</span><span class="va">ftUneqTol</span><span class="op">)</span><span class="op">$</span><span class="va">var.q</span></code></pre></div>
<pre><code>##       LV1       LV2 
##  39.26665 258.82103</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#for the quadratic term</span>
<span class="fu"><a href="../reference/getResidualCov.gllvm.html">getResidualCov</a></span><span class="op">(</span><span class="va">ftUneqTol</span><span class="op">)</span><span class="op">$</span><span class="va">var.q2</span></code></pre></div>
<pre><code>##     LV1^2     LV2^2 
##  95.95021 120.62052</code></pre>
<p>Finally, we can use the <span class="math inline">\(ordiplot(.)\)</span> function to visualize the species optima. However, since species optima can be quite large if they are unobserved, or if too little information is present in the data, creating a nice figure can be challenging. One attempt to improve readability of the species optima in a figure is to point an arrow in their general direction, if species optima are “unobserved”: outside of the range of the predicted site scores.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">ftUneqTol</span>, biplot<span class="op">=</span><span class="cn">TRUE</span>, spp.arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="vignette5_files/figure-html/quad_plot-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The standard deviation of the latent variables, presented in the summary information of the model, can serve as a measure of gradient length. This measure is different to that presented in <span class="citation">van der Veen et al. (2021)</span>, and not directly comparable to e.g. the output of axis length by Detrended Correspondence Analysis (DCA).</p>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-vanderVeen2021">
<p>van der Veen, B., F. K. C. Hui, K. A. Hovstad, E. B. Solbu, and R. B. O’Hara. 2021. “Generalized Linear Latent Variable Models for Multivariate Count and Biomass Data in Ecology.”</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jenni Niku, Wesley Brooks, Riki Herliansyah, Francis K.C. Hui, Sara Taskinen, David I. Warton, Bert van der Veen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
