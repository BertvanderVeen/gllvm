<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to use the quadratic response model • gllvm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to use the quadratic response model">
<meta property="og:description" content="gllvm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gllvm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette1.html">Analysing multivariate abundance data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette2.html">Analysing high-dimensional microbial community data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette3.html">Introduction to gllvm Part 1: Ordination</a>
    </li>
    <li>
      <a href="../articles/vignette4.html">Introduction to gllvm Part 2: Species correlations</a>
    </li>
    <li>
      <a href="../articles/vignette5.html">How to use the quadratic response model</a>
    </li>
    <li>
      <a href="../articles/vignette6.html">Ordination with predictors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JenniNiku/gllvm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How to use the quadratic response model</h1>
                        <h4 data-toc-skip class="author">Bert van der
Veen</h4>
            
            <h4 data-toc-skip class="date">2023-01-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JenniNiku/gllvm/blob/HEAD/vignettes/vignette5.Rmd" class="external-link"><code>vignettes/vignette5.Rmd</code></a></small>
      <div class="hidden name"><code>vignette5.Rmd</code></div>

    </div>

    
    
<p>In this example we demonstrate how to implement the quadratic
response model in . Quadratic curves are frequently occurring in
community ecology, specifically to describe the response of species to
the environment. When one has measured predictor variables, a quadratic
function can straightforwardly be included in a regression in R using
the <span class="math inline">\(poly(\cdot,2)\)</span> function.
However, in a GLLVM, latent variables are included that can represent
unmeasured predictors. As such, we might want to test if species respond
to those unknown predictors too. This is similar to the theory behind
other ordination methods, such as Correspondence Analysis and its
constrained variant (CCA).</p>
<p>We will use the hunting spider dataset as an example, which includes
12 species at 100 sites. It also includes measurements of the
environment at 28 sites, though we will not use those here.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JenniNiku/gllvm" class="external-link">gllvm</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"spider"</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">spider</span><span class="op">$</span><span class="va">abund</span></span></code></pre></div>
<p>The unique thing about the quadratic response model, is that
specifying a quadratic term for each species separately, coincides with
the assumption that species have their own ecological tolerances. A more
simple more, would be to assume that species have the same tolerance, in
essence that all species are a generalist or specialist to the same
degree. This can be done using a linear response model, with random
row-effects:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ftEqTol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">Y</span>, family <span class="op">=</span> <span class="st">"poisson"</span>, row.eff <span class="op">=</span> <span class="st">"random"</span>, num.lv <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Next, we can fit a model where we assume species tolerances are the
same for all species, but unique per latent variable, which we will
refer to as species common tolerances. We do this using the
<code>quadratic</code> flag in the <span class="math inline">\(\text{gllvm}(.)\)</span> function, which has the
options <code>FALSE</code>, <code>LV</code> (common tolerances), and
<code>TRUE</code> (unique tolerances for all species).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ftComTol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">Y</span>, family <span class="op">=</span> <span class="st">"poisson"</span>, num.lv <span class="op">=</span> <span class="fl">2</span>, quadratic <span class="op">=</span> <span class="st">"LV"</span><span class="op">)</span></span></code></pre></div>
<p>And lastly, we can fit the full quadratic model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ftUneqTol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">Y</span>, family <span class="op">=</span> <span class="st">"poisson"</span>, num.lv <span class="op">=</span> <span class="fl">2</span>, quadratic <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>GLLVMs are sensitive to the starting values, and with a quadratic
response model even more so. As such, the unequal tolerances model by
defaults fits a common tolerances model first, to use as starting
values. This option is control through the <code>start.struc</code>
argument in <code>start.control</code>.</p>
<p>Now, we can use information criteria to determine which of the models
fits the hunting spider data best.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/AICc.html">AICc</a></span><span class="op">(</span><span class="va">ftEqTol</span>,<span class="va">ftComTol</span>,<span class="va">ftUneqTol</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1671.791 1662.872 1455.211</span></span></code></pre>
<p>The unequal tolerances model fits best, as measured by AICc. Species
optima and tolerances, and their approximate standard errors, can be
extracted:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Species optima for LVs</span></span>
<span><span class="fu"><a href="../reference/ecoCoefs.html">optima</a></span><span class="op">(</span><span class="va">ftUneqTol</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $optima</span></span>
<span><span class="co">##                    LV1        LV2</span></span>
<span><span class="co">## Alopacce  3.965490e+00  0.0000000</span></span>
<span><span class="co">## Alopcune -5.553114e+00  2.1737870</span></span>
<span><span class="co">## Alopfabr  2.882229e+00 -5.0004136</span></span>
<span><span class="co">## Arctlute -1.064758e-01  4.3714550</span></span>
<span><span class="co">## Arctperi  4.941439e-01 -6.4059967</span></span>
<span><span class="co">## Auloalbi -2.338145e+01  3.1944201</span></span>
<span><span class="co">## Pardlugu -1.510996e+10  0.1721661</span></span>
<span><span class="co">## Pardmont  6.694648e+00  6.3037105</span></span>
<span><span class="co">## Pardnigr -2.275915e+00  2.6144288</span></span>
<span><span class="co">## Pardpull -2.559914e+00  3.3701747</span></span>
<span><span class="co">## Trocterr -2.421346e+00  2.9504054</span></span>
<span><span class="co">## Zoraspin -1.973960e+00  4.6332028</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sd</span></span>
<span><span class="co">##                   LV1       LV2</span></span>
<span><span class="co">## Alopacce 2.195068e+00 0.0000000</span></span>
<span><span class="co">## Alopcune 1.202697e+01 0.3569737</span></span>
<span><span class="co">## Alopfabr 1.842421e+00 1.6823515</span></span>
<span><span class="co">## Arctlute 1.037179e+00 0.6706263</span></span>
<span><span class="co">## Arctperi 1.640542e+00 9.4711666</span></span>
<span><span class="co">## Auloalbi 5.040738e+01 0.3823388</span></span>
<span><span class="co">## Pardlugu 2.257074e+19 0.5965602</span></span>
<span><span class="co">## Pardmont 3.404082e+00 0.7455549</span></span>
<span><span class="co">## Pardnigr 8.929421e-01 0.3604559</span></span>
<span><span class="co">## Pardpull 1.380352e+00 0.4503055</span></span>
<span><span class="co">## Trocterr 3.305201e+00 0.4162171</span></span>
<span><span class="co">## Zoraspin 6.366920e-01 0.7915519</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Species tolerances</span></span>
<span><span class="fu"><a href="../reference/ecoCoefs.html">tolerances</a></span><span class="op">(</span><span class="va">ftUneqTol</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $tolerances</span></span>
<span><span class="co">##                   LV1          LV2</span></span>
<span><span class="co">## Alopacce 1.991354e+00 75766.331108</span></span>
<span><span class="co">## Alopcune 8.945236e+00     1.474377</span></span>
<span><span class="co">## Alopfabr 1.953173e+00     3.781882</span></span>
<span><span class="co">## Arctlute 1.202133e+00     1.563114</span></span>
<span><span class="co">## Arctperi 2.258854e+00     1.534928</span></span>
<span><span class="co">## Auloalbi 8.548964e+00     1.421615</span></span>
<span><span class="co">## Pardlugu 1.795206e+05     2.500156</span></span>
<span><span class="co">## Pardmont 4.077629e+00     4.277142</span></span>
<span><span class="co">## Pardnigr 2.416366e+00     1.407778</span></span>
<span><span class="co">## Pardpull 3.464405e+00     1.353039</span></span>
<span><span class="co">## Trocterr 3.927594e+00     2.601884</span></span>
<span><span class="co">## Zoraspin 2.419449e+00     3.130584</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $sd</span></span>
<span><span class="co">##                   LV1          LV2</span></span>
<span><span class="co">## Alopacce 5.511496e-01 2.022875e+12</span></span>
<span><span class="co">## Alopcune 8.441931e+00 1.210592e-01</span></span>
<span><span class="co">## Alopfabr 6.742254e-01 8.571050e-01</span></span>
<span><span class="co">## Arctlute 4.400838e-01 6.274575e-01</span></span>
<span><span class="co">## Arctperi 1.302227e+00 6.200647e-01</span></span>
<span><span class="co">## Auloalbi 9.199530e+00 1.190251e-01</span></span>
<span><span class="co">## Pardlugu 1.340808e+14 5.221469e-01</span></span>
<span><span class="co">## Pardmont 1.478596e+00 4.625374e-01</span></span>
<span><span class="co">## Pardnigr 8.168787e-01 1.428389e-01</span></span>
<span><span class="co">## Pardpull 1.202451e+00 1.100905e-01</span></span>
<span><span class="co">## Trocterr 1.311188e+00 2.558470e-01</span></span>
<span><span class="co">## Zoraspin 8.340288e-01 4.255038e-01</span></span></code></pre>
<p>The standard deviation of the latent variables can be printed using
the <span class="math inline">\(\text{summary}(.)\)</span> function.
Since latent variable models are scale invariant, this scale parameter
is relative to the identifiability constraint (diagonal of the species
scores matrix). It can be understood as a measure of gradient length,
though for a measure that might be more comparable to DCA (i.e. on
average unit variance species curves), see the reference below.</p>
<p>The residual variation explained can be used to calculate residual
correlations, or to partition variation, similar as in the vanilla
GLLVM:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Residual variance per latent variable</span></span>
<span><span class="co">#for the linear term</span></span>
<span><span class="fu"><a href="../reference/getResidualCov.gllvm.html">getResidualCov</a></span><span class="op">(</span><span class="va">ftUneqTol</span><span class="op">)</span><span class="op">$</span><span class="va">var.q</span></span></code></pre></div>
<pre><code><span><span class="co">##       LV1       LV2 </span></span>
<span><span class="co">##  39.26665 258.82103</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#for the quadratic term</span></span>
<span><span class="fu"><a href="../reference/getResidualCov.gllvm.html">getResidualCov</a></span><span class="op">(</span><span class="va">ftUneqTol</span><span class="op">)</span><span class="op">$</span><span class="va">var.q2</span></span></code></pre></div>
<pre><code><span><span class="co">##     LV1^2     LV2^2 </span></span>
<span><span class="co">##  95.95021 120.62052</span></span></code></pre>
<p>Finally, we can use the <span class="math inline">\(\text{ordiplot}(.)\)</span> function to visualize
the species optima. However, since species optima can be quite large if
they are unobserved, or if too little information is present in the
data, creating a nice figure can be challenging. One attempt to improve
readability of the species optima in a figure is to point an arrow in
their general direction, if species optima are “unobserved”: outside of
the range of the predicted site scores.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">ftUneqTol</span>, biplot<span class="op">=</span><span class="cn">TRUE</span>, spp.arrows <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignette5_files/figure-html/quad_plot-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The standard deviation of the latent variables, presented in the
summary information of the model, can serve as a measure of gradient
length. This measure is different to that presented in <span class="citation">van der Veen et al. (2021)</span>, and not directly
comparable to e.g. the output of axis length by Detrended Correspondence
Analysis (DCA).</p>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-vanderVeen2021a" class="csl-entry">
Veen, B. van der, F.K.C. Hui, K.A. Hovstad, E.B. Solbu, and R.B. O’Hara.
2021. <span>“Model-Based Ordination for Species with Unequal Niche
Widths.”</span> 12: 1288–1300.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jenni Niku, Wesley Brooks, Riki Herliansyah, Francis K.C. Hui, Pekka Korhonen, Sara Taskinen, Bert van der Veen, David I. Warton.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
