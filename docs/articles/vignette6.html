<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model-based constrained ordination with latent variables • gllvm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model-based constrained ordination with latent variables">
<meta property="og:description" content="gllvm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gllvm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette1.html">Analysing multivariate abundance data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette2.html">Analysing high-dimensional microbial community data using gllvm</a>
    </li>
    <li>
      <a href="../articles/vignette3.html">Introduction to gllvm Part 1: Ordination</a>
    </li>
    <li>
      <a href="../articles/vignette4.html">Introduction to gllvm Part 2: Species correlations</a>
    </li>
    <li>
      <a href="../articles/vignette5.html">How to use the quadratic response model</a>
    </li>
    <li>
      <a href="../articles/vignette6.html">Model-based constrained ordination with latent variables</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JenniNiku/gllvm/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette6_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="vignette6_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="vignette6_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model-based constrained ordination with latent variables</h1>
                        <h4 class="author">Bert van der Veen</h4>
            
            <h4 class="date">2021-07-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JenniNiku/gllvm/blob/master/vignettes/vignette6.Rmd"><code>vignettes/vignette6.Rmd</code></a></small>
      <div class="hidden name"><code>vignette6.Rmd</code></div>

    </div>

    
    
<p>Until recently, the <code>gllvm</code> R-package only supported unconstrained ordination. When including predictor variables, the interpretation of the ordination would shift to a residual ordination, conditional on the predictors.</p>
<p>However, if the number of predictor variables is large and so is the number of species, including predictors can result in a very large number of parameters to estimate. For data of ecological communities, which can be quite sparse, this is not always a reasonable model to fit. As alternative, ecologists have performed constrained ordination for decades, with methods such as Canonical Correspondence Analysis, or Redundancy Analysis.</p>
<p>In this vignette, we demonstrate how to perform constrained ordination with the <code>gllvm</code> R-package. We load the hunting spider dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JenniNiku/gllvm">gllvm</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">spider</span><span class="op">)</span>
<span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">spider</span><span class="op">$</span><span class="va">abund</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="va">spider</span><span class="op">$</span><span class="va">x</span>

<span class="co">#And scale the predictors</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></code></pre></div>
<p>which includes six predictor variables: “soil.dry”: soil dry mass, “bare.sand”: cover bare sand, “fallen.leaves”: “cover of fallen leaves”, “moss”: cover moss, “herb.layer”: cover of the herb layer, “reflection”: “reflection of the soil surface with a cloudless sky”.</p>
<p>For that, it is important to first understand what a constrained ordination is. Classical constrained ordination is statistically referred to as reduced rank regression (RRR). First, consider a multivariate Generalized Linear Model (GLM):</p>
<p><span class="math display">\[\begin{equation}
\eta_{ij} = \beta_{0j} + \boldsymbol{X}_i^\top\boldsymbol{\beta}_j.
\end{equation}\]</span></p>
<p>Here, <span class="math inline">\(\boldsymbol{\beta}_j\)</span> are the slopes that represent a species responses to <span class="math inline">\(K\)</span> predictor variables at site <span class="math inline">\(i\)</span>, <span class="math inline">\(\boldsymbol{X}_i\)</span>. In the <code>gllvm</code> R-package, the code to fit this model is:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MGLM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">Y</span>,X<span class="op">=</span><span class="va">X</span>,family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span></code></pre></div>
<p>The “rank” of <span class="math inline">\(\boldsymbol{X}_i^\top\boldsymbol{\beta}_j\)</span> is <span class="math inline">\(K\)</span>. RRR introduces a constraint on the species slopes matrix, namely on the number of independent columns in <span class="math inline">\(\boldsymbol{\beta}_j\)</span> (a column is not independent when it can be formulated as a linear combination of another). The reduced ranks are in community ecology referred to as ecological gradients, or can be understood as ordination axes. If we define a latent variable <span class="math inline">\(\boldsymbol{z}_i = \boldsymbol{B}^\top\boldsymbol{X}_{i,lv} + \boldsymbol{\epsilon}_i\)</span>, for a <span class="math inline">\(K\times d\)</span> matrix of slopes, we can understand RRR as a regression of the latent variable or ecological gradient, except that the residual <span class="math inline">\(\boldsymbol{\epsilon}_i\)</span> is omitted, i.e. we assume that the ecological gradient can be represented perfectly by the predictor variables, so that the model becomes: <span class="math display">\[\begin{equation}
\eta_{ij} = \beta_{0j} + \boldsymbol{X}_i^\top\boldsymbol{B}\boldsymbol{\gamma}_j.
\end{equation}\]</span></p>
<p>Where <span class="math inline">\(\boldsymbol{\gamma}_j\)</span> is a set of reduced rank slopes for each species. This model can also be fitted in, e.g., the <code>VGAM</code> R-package. This parametrization is practically useful, as it drastically reduces the number of parameters compared to multivariate regression. The Rank can be determined by cross-validation, or alternatively, using information criteria. The code for this in the <code>gllvm</code> R-package, for an arbitrary choice of Rank 2, is:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">RRGLM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">Y</span>,X<span class="op">=</span><span class="va">X</span>,family<span class="op">=</span><span class="st">"poisson"</span>, num.RR<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>The reduced rank slopes are available under <code>RRGLM$params$LvXcoef</code>. Note: in general to improve convergence, it is good practice to center and scale the predictor variables. Unlike in other R-packages, we can now formulate a RRR with residual (because let’s face it, how often are we 100% confident that we have measured all relevant predictors?), so that we can assume that the ecological gradient is represented by unmeasured and measured predictors (the latter is how the residual can be understood). The code for this is:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CGLLVM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">Y</span>,X<span class="op">=</span><span class="va">X</span>,family<span class="op">=</span><span class="st">"poisson"</span>, num.lv.c <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>The number of reduced ranks, constrained latent variables, unconstrained latent variables can be freely combined using the <code>num.RR</code>, <code>num.lv.c</code> and <code>num.lv</code> arguments (but be careful not to overparameterize or overfit your model!). It is also possible to combine those arguments with full-rank predictors. If combining RRR (with or without latent variable), with full-rank predictors, the formula interface has to be used:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PCGLLVM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gllvm.html">gllvm</a></span><span class="op">(</span><span class="va">Y</span>,X<span class="op">=</span><span class="va">X</span>,family<span class="op">=</span><span class="st">"poisson"</span>, num.lv.c <span class="op">=</span> <span class="fl">2</span>, lv.formula <span class="op">=</span> <span class="op">~</span><span class="va">bare.sand</span><span class="op">+</span><span class="va">fallen.leaves</span><span class="op">+</span><span class="va">moss</span><span class="op">+</span><span class="va">herb.layer</span><span class="op">+</span><span class="va">reflection</span>, formula <span class="op">=</span> <span class="op">~</span><span class="va">soil.dry</span><span class="op">)</span></code></pre></div>
<p>where <code>RR.formula</code> is the formula for the constrained ordination, and <code>X.formula</code> is the formula which informs the model which predictors should be modelled in full-rank. Note, that those two formulas cannot include the same predictor variables, and all predictor variables should be provided in the <code>X</code> argument. In essence, this performs a partial constrained ordination with latent variables. Reduced Rank regression can never include an (additional) intercept as it can be re-parameterized into a model with only <span class="math inline">\(\beta_{0j}\)</span>.</p>
<p>Though we did not do so here, information criteria can be used to determine the correct number of Reduced Ranks, or in general the correct number of constrained and unconstrained latent variables. Our recommendation is not to perform model-selection on the included predictor variables, but to mostly focus on the Ranks (if this causes convergence issues, first scale and centre predictors, and if that doesn’t help perform model-selection on the predictors). A wald-statistic with accompanying p-values can then be used to determine significance of the predictors:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">CGLLVM</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## gllvm(y = Y, X = X, num.lv.c = 2, family = family, n.init = 10)
## 
## Family:  poisson 
## 
## AIC:  1666.276 AICc:  1681.943 BIC:  1728.89 LL:  -786.1 df:  47 
## 
## Constrained LVs:  2 
## Reduced Ranks:  0 
## Unconstrained LVs:  0 
## Standard deviation of LVs:  0.5183 0.6907 
## 
## Formula:  ~ 1 
## LV formula:  ~0 + soil.dry + bare.sand + fallen.leaves + moss + herb.layer + reflection 
## 
## Coefficients LV predictors:
##                      Estimate Std. Error z value Pr(&gt;|z|)    
## X.soil.dry(LV1)        0.3801     0.2462   1.544   0.1226    
## X.bare.sand(LV1)       0.2642     0.1766   1.496   0.1347    
## X.fallen.leaves(LV1)  -0.6957     0.3074  -2.263   0.0236 *  
## X.moss(LV1)            0.8177     0.1999   4.090 4.31e-05 ***
## X.herb.layer(LV1)      0.1325     0.1791   0.740   0.4595    
## X.reflection(LV1)      0.4973     0.2759   1.803   0.0714 .  
## X.soil.dry(LV2)        1.5032     0.3675   4.090 4.31e-05 ***
## X.bare.sand(LV2)      -0.3265     0.2323  -1.405   0.1599    
## X.fallen.leaves(LV2)  -0.8952     0.4039  -2.217   0.0267 *  
## X.moss(LV2)           -0.1123     0.3243  -0.346   0.7291    
## X.herb.layer(LV2)      0.5560     0.2359   2.357   0.0184 *  
## X.reflection(LV2)     -0.4909     0.3798  -1.293   0.1962    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Finally, we can use all the other tools in the  R-package for inference, such as creating an ordination diagram with arrows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ordiplot.gllvm.html">ordiplot</a></span><span class="op">(</span><span class="va">CGLLVM</span>, biplot<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="vignette6_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;"> Arrows that show as less intense red (pink), are predictors of which the confidence interval for the slope includes zero, for at least one of the two plotted dimensions. There are various arguments inlcuded in the function to improve readability of the figure, have a look at its documentation. The arrows are always proportional to the size of the plot, so that the predictor with the largest slope estimate is the largest arrow. If the predictors have no effect, the slopes <span class="math inline">\(\boldsymbol{B}\)</span> will be close to zero.</p>
<p>It is also possible to use the <code>quadratic</code> flag to fit a quadratic response model though we will not demonstrate that here, or to partition variance per latent variable and for specific predictors.</p>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jenni Niku, Wesley Brooks, Riki Herliansyah, Francis K.C. Hui, Sara Taskinen, David I. Warton, Bert van der Veen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
